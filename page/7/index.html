<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"simuty.com","root":"/","scheme":"Gemini","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录点滴、分享所得">
<meta property="og:type" content="website">
<meta property="og:title" content="简单即是美">
<meta property="og:url" content="https://simuty.com/page/7/index.html">
<meta property="og:site_name" content="简单即是美">
<meta property="og:description" content="记录点滴、分享所得">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Howard">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://simuty.com/page/7/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>简单即是美</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168603273-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168603273-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7b295d599a09ce76e6f5d95b315b3519";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">简单即是美</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard</p>
  <div class="site-description" itemprop="description">记录点滴、分享所得</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/simuty" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;simuty" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="reading-progress-bar"></div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content index posts-expand">
          
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/24/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/24/index/" class="post-title-link" itemprop="url">Python基础系列之面向对象编程【14】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-24 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-24T10:38:59+08:00">2019-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.3k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <img data-src="1.png" width="50%" height="50%" align=center />
摘要内容......
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/05/24/index/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/19/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/19/index/" class="post-title-link" itemprop="url">Python基础系列之装饰器【12】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-19 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-19T10:38:59+08:00">2019-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.1k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img data-src="cheap.png" alt=""></p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul>
<li>温故函数很多概念</li>
<li>掌握 Python 装饰器</li>
</ul>
<blockquote>
<p>如果能准确的表述下侧代码的结果</p>
<p>就不用往下看啦，想必你已经掌握了 Python 装饰器</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"1"</span>)</span><br><span class="line">        print(<span class="string">"foo---%s"</span> % func)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"2"</span></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"3"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"4"</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"===foo===="</span>)</span><br><span class="line">print(foo)</span><br><span class="line">print(<span class="string">"===foo()===="</span>)</span><br><span class="line">print(foo())</span><br><span class="line">print(<span class="string">"===outer(foo)===="</span>)</span><br><span class="line">print(outer(foo))</span><br><span class="line">print(<span class="string">"===outer(foo())===="</span>)</span><br><span class="line">print(outer(foo()))</span><br><span class="line">print(<span class="string">"===outer(foo())()===="</span>)</span><br><span class="line">print(outer(foo())())</span><br></pre></td></tr></table></figure>

<p>先认真回忆下之前函数的相关章节内容<br><strong>不难但可能有点绕</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">===foo====</span><br><span class="line">&lt;<span class="function"><span class="keyword">function</span> <span class="title">foo</span> <span class="title">at</span> 0<span class="title">x7fcae64dbea0</span>&gt;</span></span><br><span class="line"><span class="function">===<span class="title">foo</span>(<span class="params"></span>)====</span></span><br><span class="line"><span class="function">3</span></span><br><span class="line"><span class="function">4</span></span><br><span class="line"><span class="function">===<span class="title">outer</span>(<span class="params">foo</span>)====</span></span><br><span class="line"><span class="function">&lt;<span class="title">function</span> <span class="title">outer</span>.&lt;<span class="title">locals</span>&gt;.<span class="title">inner</span> <span class="title">at</span> 0<span class="title">x7fcae64dbe18</span>&gt;</span></span><br><span class="line"><span class="function">===<span class="title">outer</span>(<span class="params">foo(</span>))====</span></span><br><span class="line"><span class="function">3</span></span><br><span class="line"><span class="function">&lt;<span class="title">function</span> <span class="title">outer</span>.&lt;<span class="title">locals</span>&gt;.<span class="title">inner</span> <span class="title">at</span> 0<span class="title">x7fcae645d598</span>&gt;</span></span><br><span class="line"><span class="function">===<span class="title">outer</span>(<span class="params">foo(</span>))(<span class="params"></span>)====</span></span><br><span class="line"><span class="function">3</span></span><br><span class="line"><span class="function">1</span></span><br><span class="line"><span class="function"><span class="title">foo</span>---4</span></span><br><span class="line"><span class="function">2</span></span><br></pre></td></tr></table></figure>

<p>没答出来，或对装饰器有疑惑，那就即可开始吧</p>
<h3 id="第一部分-前奏"><a href="#第一部分-前奏" class="headerlink" title="第一部分 前奏"></a>第一部分 前奏</h3><p>针对于开头的那块代码逐步分析下，究竟再内存中是<code>如何运行的❓</code> <code>执行顺序是什么❓</code></p>
<p><strong>强烈推荐网址：<a href="http://pythontutor.com/live.html#mode=edit" target="_blank" rel="noopener">代码可视化执行过程</a></strong></p>
<p>这几行代码主要为了加深理解代码的<code>执行过程</code>、<code>函数名</code>、<code>函数调用</code>等等</p>
<p><code>结合代码与下侧图示</code>，重温那些我们习以为常的东西。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"1"</span>)</span><br><span class="line">        print(<span class="string">"foo---%s"</span> % func)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"2"</span></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"3"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"4"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将函数 outer、foo 加载到内存中</span></span><br><span class="line"><span class="comment"># 以上代码到此行，未执行</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"===foo===="</span>)</span><br><span class="line"><span class="comment"># foo【函数名】；</span></span><br><span class="line"><span class="comment"># 执行：对应的【函数信息】；返回：🈚️</span></span><br><span class="line">print(foo)</span><br><span class="line">print(<span class="string">"===foo()===="</span>)</span><br><span class="line"><span class="comment"># 真正执行 foo函数</span></span><br><span class="line"><span class="comment"># 执行：打印 3； 返回 4</span></span><br><span class="line">print(foo())</span><br><span class="line">print(<span class="string">"===outer(foo)===="</span>)</span><br><span class="line"><span class="comment"># 将【foo函数名】传给【outer函数】，参数为 【函数名】</span></span><br><span class="line"><span class="comment"># 执行：将inner加载到内存，返回：🈚️</span></span><br><span class="line">print(outer(foo))</span><br><span class="line">print(<span class="string">"===outer(foo())===="</span>)</span><br><span class="line"><span class="comment"># 调用【foo函数】，将4作为参数传给传给【outer函数】</span></span><br><span class="line"><span class="comment"># 执行：打印3 返回4， 打印outer函数的返回值 inner内存信息</span></span><br><span class="line">print(outer(foo()))</span><br><span class="line">print(<span class="string">"===outer(foo())()===="</span>)</span><br><span class="line"><span class="comment"># 调用【foo函数】，将4作为参数传给传给【outer函数】，调用inner函数</span></span><br><span class="line"><span class="comment"># 执行：打印3 返回4，进而打印 1 、 4【func()]、2以及inner的返回值2</span></span><br><span class="line"><span class="comment"># over！！！</span></span><br><span class="line">print(outer(foo())())</span><br></pre></td></tr></table></figure>

<p>我觉得，先把这些看似简单的东西理清楚，对接下来，装饰器的理解更容易些</p>
<h3 id="第二部分-装饰器【基础】"><a href="#第二部分-装饰器【基础】" class="headerlink" title="第二部分 装饰器【基础】"></a>第二部分 装饰器【基础】</h3><h4 id="1-装饰器是什么"><a href="#1-装饰器是什么" class="headerlink" title="1 装饰器是什么"></a>1 装饰器是什么</h4><p>装饰器（Decorator）：可以在不修改原有代码的情况下，为被装饰的对象增加新的功能或者附加限制条件或者帮助输出。<strong>原则：开放封闭</strong></p>
<p><strong>分类</strong></p>
<ol>
<li>函数装饰器；</li>
<li>类的装饰器。</li>
</ol>
<p>最近公司也在用装饰器，不过是再 Nodejs 中用的；<br>举个别的例子。因为某种原因，需要对每个接口进行<strong>认证</strong>、<strong>记录日志</strong>，如何快速高效的实现这样的需求 ❓</p>
<p><code>可能有几种思路</code></p>
<ul>
<li>在基类中写相应的方法，如果有的话；</li>
<li>写两个函数【认证的、日志的】，在每个接口中添加；</li>
<li>等等思路</li>
</ul>
<h4 id="2-简单的装饰器"><a href="#2-简单的装饰器" class="headerlink" title="2 简单的装饰器"></a>2 简单的装饰器</h4><p>但今天只能选<strong>装饰器</strong>，因为不能偏离主题啦，描述了需求就开始干吧！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">"装饰器启动,自动执行"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"统一认证"</span>)</span><br><span class="line">        result = func()</span><br><span class="line">        print(<span class="string">"记录日志信息"</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"接口1"</span>)</span><br><span class="line">f1()</span><br></pre></td></tr></table></figure>

<p>返回值：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">装饰器启动,自动执行</span><br><span class="line">统一认证</span><br><span class="line">接口<span class="number">1</span></span><br><span class="line">记录日志信息</span><br></pre></td></tr></table></figure>

<p>大致和第一部分的例子有点类似，不同的是</p>
<ol>
<li>inner 函数返回了个函数</li>
<li>多个<code>@outer</code></li>
</ol>
<p>@outer 中的<code>@</code>是注解语法糖；<strong>把 f1 作为参数传给 outer</strong>,今儿满足我们的<code>开放封闭的原则</code>;</p>
<p>其解释器会解释成下面这样的语句：<br><strong>*@outer &lt;=&gt; outer(f1)</strong></p>
<p>翻译成函数调用, 我们用新的例子来对比一下，其实就是下侧这样的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"接口2"</span>)</span><br><span class="line">outer(f2)()</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">装饰器启动,自动执行</span></span><br><span class="line"><span class="string">统一认证</span></span><br><span class="line"><span class="string">接口1</span></span><br><span class="line"><span class="string">记录日志信息</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<p>了解了上述的调用含义， <strong>@outer &lt;=&gt; outer(f1)</strong></p>
<blockquote>
<p>注： 传的只是函数名</p>
</blockquote>
<p><img data-src="doc1.jpg" alt="自动执行"></p>
<p>整体的流程</p>
<ol>
<li>自上而下执行，将函数<code>outer</code>在内存注册；</li>
<li>执行到@outer 时，将<code>函数名f1</code>作为参数传给<code>@outer</code>;</li>
<li>调用 outer 函数，执行打印【装饰器启动,自动执行】；</li>
<li>函数 inner 在内存注册，内存地址：<strong>[xxxx]</strong>，返回【inner 函数名】，</li>
<li>将函数<code>f1</code>在内存注册；其实是直接指向 <strong>[xxxx]</strong></li>
<li>调用 f1(), 直接调用第五步的 <strong>[xxxx]</strong>， 也就是第四步的；</li>
<li>打印【统一认证】；</li>
<li>result = func()<strong>执行回调</strong>【f1】函数, 打印：接口 1，没有返回值，result = None</li>
<li>回到<code>inner()</code>,打印<code>记录日志信息</code>;</li>
<li>返回 None，OVER!</li>
</ol>
<p><code>注</code>：完整的有 17 步，动图还不会制作，可以前往–&gt;<a href="http://pythontutor.com/live.html#mode=edit" target="_blank" rel="noopener">代码可视化网址</a>**，查看完整的步骤。</p>
<blockquote>
<p>实在是想不出来，如何用图来表示装饰器，有相应的图示，请介绍。</p>
</blockquote>
<p>比较喜欢这段代码, 挺有意思的。O(∩_∩)O 哈哈~<br><a href="https://coolshell.cn/articles/11265.html" target="_blank" rel="noopener">来源</a></p>
<p>会自动打印结果，因为采用了装饰器</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"fuck %s!"</span> % fn.__name__[::<span class="number">-1</span>].upper()</span><br><span class="line"></span><br><span class="line"><span class="meta">@fuck</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wfg</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="第三部分-装饰器【进阶】"><a href="#第三部分-装饰器【进阶】" class="headerlink" title="第三部分 装饰器【进阶】"></a>第三部分 装饰器【进阶】</h3><p>如果没有看明白第二部分，还是这回去，沉下心，专注的、认真的读下去，真的不难，好好分析下流程，一步一个脚印，踩实了！</p>
<blockquote>
<p>只介绍最基础的代码，就是耍流氓</p>
</blockquote>
<h4 id="1-多个装饰器"><a href="#1-多个装饰器" class="headerlink" title="1 多个装饰器"></a>1 多个装饰器</h4><p><a href="https://blog.csdn.net/u013411246/article/details/80571462" target="_blank" rel="noopener">下侧代码来源</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#当有多个装饰器装饰一个函数时，他们的执行顺序</span></span><br><span class="line"><span class="comment">#观察下方的代码就会发现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator_a</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'Get in decorator_a'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner_a</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'Get in inner_a'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> inner_a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator_b</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'Get in decorator_b'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner_b</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'Get in inner_b'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> inner_b</span><br><span class="line">  </span><br><span class="line"><span class="meta">@decorator_b</span></span><br><span class="line"><span class="meta">@decorator_a</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    print(<span class="string">'Get in f'</span>)</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">f(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Get in decorator_a</span></span><br><span class="line"><span class="string">Get in decorator_b</span></span><br><span class="line"><span class="string">Get in inner_b</span></span><br><span class="line"><span class="string">Get in inner_a</span></span><br><span class="line"><span class="string">Get in f</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<p>调用时，函数的顺序</p>
<ol>
<li>顺序等同于==&gt; <strong>decorator_b(decorator_a(f))</strong>,返回的是inner_b,所以执行的时候是先执行inner_b</li>
<li>然后在执行【decorator_a(f)】返回的inner_a  .最终在调用f(1)的时候，函数inner_b输出’Get in inner_b’</li>
<li>执行inner_a输出Get in decorator_a，最后执行func(),即f</li>
</ol>
<h4 id="2-多参多装饰器"><a href="#2-多参多装饰器" class="headerlink" title="2 多参多装饰器"></a>2 多参多装饰器</h4><p>为了更加深入的了解，装饰器，摘录<a href="https://coolshell.cn/articles/11265.html" target="_blank" rel="noopener">酷 壳 博客</a>上的一段代码，好像<a href="https://wiki.python.org/moin/PythonDecoratorLibrary" target="_blank" rel="noopener">官网实例代码</a>也不少;</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeHtmlTag</span><span class="params">(tag, *args, **kwds)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">real_decorator</span><span class="params">(fn)</span>:</span></span><br><span class="line">        css_class = <span class="string">" class='&#123;0&#125;'"</span>.format(kwds[<span class="string">"css_class"</span>]) \</span><br><span class="line">                                     <span class="keyword">if</span> <span class="string">"css_class"</span> <span class="keyword">in</span> kwds <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">(*args, **kwds)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;"</span>+tag+css_class+<span class="string">"&gt;"</span> + fn(*args, **kwds) + <span class="string">"&lt;/"</span>+tag+<span class="string">"&gt;"</span></span><br><span class="line">        <span class="keyword">return</span> wrapped</span><br><span class="line">    <span class="keyword">return</span> real_decorator</span><br><span class="line"> </span><br><span class="line"><span class="meta">@makeHtmlTag(tag="b", css_class="bold_css")</span></span><br><span class="line"><span class="meta">@makeHtmlTag(tag="i", css_class="italic_css")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello world"</span></span><br><span class="line"> </span><br><span class="line">print(hello())</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&lt;b class='bold_css'&gt;&lt;i class='italic_css'&gt;hello world&lt;/i&gt;&lt;/b&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>


<h4 id="3-再深入一些"><a href="#3-再深入一些" class="headerlink" title="3 再深入一些"></a>3 再深入一些</h4><p>表示还没有研究这段代码，先分享出来<br>摘录<a href="https://coolshell.cn/articles/11265.html" target="_blank" rel="noopener">酷 壳 博客</a>上的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">memo</span><span class="params">(fn)</span>:</span></span><br><span class="line">    cache = &#123;&#125;</span><br><span class="line">    miss = object()</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @wraps(fn)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args)</span>:</span></span><br><span class="line">        result = cache.get(args, miss)</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> miss:</span><br><span class="line">            result = fn(*args)</span><br><span class="line">            cache[args] = result</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"> </span><br><span class="line"><span class="meta">@memo</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fib(n - <span class="number">1</span>) + fib(n - <span class="number">2</span>)</span><br></pre></td></tr></table></figure>


<p>Python函数告一段落了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/18/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/18/index/" class="post-title-link" itemprop="url">Python基础系列之--匿名函数闭包【11】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-18 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-18T10:38:59+08:00">2019-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.8k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>存在即合理<br>正如明白了<code>x += 1</code>，就会尽量避免<code>x = x + 1</code>;</p>
</blockquote>
<h4 id="反观一搜一大把关于闭包的文章，无外乎只是告诉三点"><a href="#反观一搜一大把关于闭包的文章，无外乎只是告诉三点" class="headerlink" title="反观一搜一大把关于闭包的文章，无外乎只是告诉三点"></a>反观一搜一大把关于闭包的文章，无外乎只是告诉三点</h4><ul>
<li>晦涩难懂的概念</li>
<li>给几个简单的实例</li>
<li>结束<br>或许还会给个建议 <strong>少用</strong></li>
</ul>
<blockquote>
<p>真的是这样么？<br>我搜索了大量的资料来写这篇文章，只是想尽力把自己说服、说明了。</p>
</blockquote>
<p>下边有三到题目以及答案</p>
<ul>
<li>如果你的预期和答案不符</li>
<li>如果你看不懂</li>
<li>如果你好奇的想一探究竟</li>
</ul>
<blockquote>
<p>请继续</p>
<blockquote>
<p>否则就可以关闭这个文章了</p>
</blockquote>
<blockquote>
<p>文章长且内容多</p>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第一题，是用来做什么的？</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(start, stop)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> filter(<span class="keyword">lambda</span> x : <span class="keyword">not</span> [x % i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, x) <span class="keyword">if</span> x % i == <span class="number">0</span>], range(start, stop + <span class="number">1</span>))</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第二题</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_counter</span><span class="params">()</span>:</span></span><br><span class="line">  i = <span class="number">10</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(x=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">nonlocal</span> i</span><br><span class="line">    i += x</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> count</span><br><span class="line">a_count = new_counter()</span><br><span class="line">print(a_count())</span><br><span class="line">print(a_count())</span><br><span class="line">print(a_count(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第三题</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeActions</span><span class="params">()</span>:</span></span><br><span class="line">    acts = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        acts.append(<span class="keyword">lambda</span> x: i ** x)</span><br><span class="line">    <span class="keyword">return</span> acts</span><br><span class="line">acts = makeActions()</span><br><span class="line">print(acts[<span class="number">0</span>](<span class="number">2</span>))</span><br><span class="line">print(acts[<span class="number">1</span>](<span class="number">2</span>))</span><br><span class="line">print(acts[<span class="number">2</span>](<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p><strong>答案</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第二题</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">15</span></span><br><span class="line"><span class="comment"># 第三题</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>警示：认真的读下去，可能会花费你不少的时间</p>
</blockquote>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul>
<li>掌握匿名函数</li>
<li>掌握高阶函数与匿名函数的用法</li>
<li>尽量搞明白闭包</li>
</ul>
<p><img data-src="/2019/05/18/index/closuer.png" alt="目录结构"></p>
<h3 id="第一部分-匿名函数"><a href="#第一部分-匿名函数" class="headerlink" title="第一部分 匿名函数"></a>第一部分 匿名函数</h3><h4 id="1-定义"><a href="#1-定义" class="headerlink" title="1 定义"></a>1 定义</h4><p><code>lambda 函数</code>也叫<code>匿名函数</code>，及即没有具体名称的函数，它允许快速定义单行函数，类似于 C 语言的宏，可以用在任何需要函数的地方。</p>
<p>lambda与def对比</p>
<table>
<thead>
<tr>
<th>区别</th>
<th>def</th>
<th>lambda</th>
</tr>
</thead>
<tbody><tr>
<td>名称</td>
<td>有</td>
<td>无</td>
</tr>
<tr>
<td>返回值</td>
<td>函数对象但不给标识符</td>
<td>任意</td>
</tr>
<tr>
<td>作用</td>
<td>简单的</td>
<td>简单/复杂</td>
</tr>
<tr>
<td>作用范围</td>
<td>不能共享</td>
<td>可共享</td>
</tr>
</tbody></table>
<h4 id="2-表达式"><a href="#2-表达式" class="headerlink" title="2 表达式"></a>2 表达式</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funName</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 表达式</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"返回值"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 匿名函数</span></span><br><span class="line"><span class="keyword">lambda</span> argument1,argument2,...argumentN:expression using arguments</span><br><span class="line"></span><br><span class="line"><span class="keyword">lambda</span> 参数: 表达式</span><br></pre></td></tr></table></figure>

<p><code>实现同样代码不同方式的实例：</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">mul</span><span class="params">(x, y)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x*y</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mul(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="comment"># 匿名函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lam = <span class="keyword">lambda</span> x, y: x*y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lam</span><br><span class="line">&lt;function &lt;<span class="keyword">lambda</span>&gt; at <span class="number">0x101b11268</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lam(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lam(<span class="number">2</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: &lt;<span class="keyword">lambda</span>&gt;() missing <span class="number">1</span> required positional argument: <span class="string">'y'</span></span><br></pre></td></tr></table></figure>

<h4 id="3-匿名函数与高阶函数"><a href="#3-匿名函数与高阶函数" class="headerlink" title="3 匿名函数与高阶函数"></a>3 匿名函数与高阶函数</h4><p>Python内置对数据处理的函数，<strong>效率比for要高</strong>，恰好，我们可以结合lambda函数，<code>一块把二者学习了</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 罗列了常用的三种</span></span><br><span class="line">1. map(function, iterable[, iterable, ...]) -&gt; list</span><br><span class="line"></span><br><span class="line">2. filter(function or None, iterable) -&gt; list, tuple, or string</span><br><span class="line"></span><br><span class="line">3. reduce(function, sequence[, initial]) -&gt; value</span><br></pre></td></tr></table></figure>

<h4 id="简要介绍："><a href="#简要介绍：" class="headerlink" title="简要介绍："></a>简要介绍：</h4><ul>
<li><strong>map映射</strong>: 对iterable中的item依次执行function(item)，执行结果输出为list</li>
<li><strong>filter过滤</strong>: 对iterable中的item依次执行function(item)，将执行结果为True（！=0）的item组成一个List/String/Tuple（取决于iterable的类型）返回，False则退出（0），进行过滤。</li>
<li><strong>reduce</strong>: iterable中的item顺序迭代调用function，函数必须要有2个参数。要是有第3个参数，则<strong>表示初始值</strong>，可以继续调用初始值，返回一个值</li>
</ul>
<h4 id="图解："><a href="#图解：" class="headerlink" title="图解："></a>图解：</h4><p><img data-src="/2019/05/18/index/map.png" alt="map"><br><img data-src="/2019/05/18/index/filter.png" alt="filter"><br><img data-src="/2019/05/18/index/s5_reduce_function.svg" alt="reduce"></p>
<h4 id="实例列表"><a href="#实例列表" class="headerlink" title="实例列表"></a>实例列表</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ------- map ------- #</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map(str, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">[<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map(int, [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>])</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map(<span class="keyword">lambda</span> x: x * x, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])   <span class="comment"># 使用 lambda</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ------- reduce ------- #</span></span><br><span class="line"><span class="comment"># reduce 操作实例</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(<span class="keyword">lambda</span> x, y: x * y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])  <span class="comment"># 相当于 ((1 * 2) * 3) * 4</span></span><br><span class="line"><span class="number">24</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(<span class="keyword">lambda</span> x, y: x * y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>) <span class="comment"># ((((5 * 1) * 2) * 3)) * 4</span></span><br><span class="line"><span class="number">120</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="keyword">lambda</span> a, b: a <span class="keyword">if</span> (a &gt; b) <span class="keyword">else</span> b   <span class="comment"># 两两比较，取最大值 【三目运算也在阶段汇总与补充中说明】</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(f, [<span class="number">5</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">10</span>])</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------- filter ------- #</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list = filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(*list)</span><br><span class="line"><span class="number">2</span> <span class="number">4</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h4 id="两个综合实例"><a href="#两个综合实例" class="headerlink" title="两个综合实例"></a>两个综合实例</h4><p><strong>这个就是开头的那个实例： 找出指定返回内的质子</strong>，涉及的内容有点多，包含之前章节中的<code>推导式</code>、<code>range函数</code>、<code>函数</code>、<code>not</code>等相关内容，试着先看下，是否能看明白。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 质数的定义 只有1和它本身两个因数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(start, stop)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="comment"># 取出质数,x从range(start,stop+1) 取的数</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> filter(<span class="keyword">lambda</span> x : <span class="keyword">not</span> [x % i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, x) <span class="keyword">if</span> x % i == <span class="number">0</span>], range(start, stop + <span class="number">1</span>))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isPrime(<span class="number">11</span>, <span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(result)</span><br><span class="line">&lt;filter object at <span class="number">0x101b12400</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(list(result))</span><br><span class="line">[<span class="number">11</span>]</span><br></pre></td></tr></table></figure>

<p><a href="http://pythontutor.com/live.html#code=def%20isPrime%28start,%20stop%29%3A%0A%20%20%20%20%20%23%20%E5%8F%96%E5%87%BA%E8%B4%A8%E6%95%B0,x%E4%BB%8Erange%28start,stop%2B1%29%20%E5%8F%96%E7%9A%84%E6%95%B0%0A%20%20%20%20%20return%20filter%28lambda%20x%20%3A%20not%20%5Bx%20%25%20i%20for%20i%20in%20range%282,%20x%29%20if%20x%20%25%20i%20%3D%3D%200%5D,%20range%28start,%20stop%20%2B%201%29%29%0Aprint%28list%28isPrime%2811,%2012%29%29%29&cumulative=true&curInstr=36&heapPrimitives=true&mode=display&origin=opt-live.js&py=3&rawInputLstJSON=%5B%5D&textReferences=false" target="_blank" rel="noopener">整个过程的步骤有三七步骤</a></p>
<p>试了下画个流程图，来作为补充，但是我怕画出来，更难理解了；<br>所以就用文字描述下，希望描述的清楚：</p>
<ul>
<li>1 range(start, stop + 1) 生成 <code>[)左闭右开</code>的<strong>list_1数组</strong></li>
<li>2 依次将list_1中的数【x】传给<code>匿名函数</code>；<strong>【循环该操作】</strong><ul>
<li>3 生成[2, x)的<strong>list_2</strong></li>
<li>4 遍历list_2， 依次用 <em><code>x%list_2[i]</code>取余；*</em>【循环该操作】**</li>
<li>5 如果数组长度等于0，回到<code>2</code></li>
<li>6 如果余数等于0，返回余数，存进<code>list_new</code>;</li>
<li>7 等整个<strong>2</strong>走完，判断<code>list_new</code>是否存在数据，得出当前x是否是质数，是否从list_1中过滤掉</li>
<li>8 进入<strong>list_1</strong>下一个元素的判断</li>
</ul>
</li>
</ul>
<p>先熟悉下not的用法，【在阶段汇总与补充中说明】</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">not</span> []</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">not</span> [<span class="number">1</span>]</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">not</span> [<span class="number">0</span>]</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>


<p>下边这个求阶乘的，没啥难度，只要还记得</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 思考下这个，在思考下上边关于reduce的图例</span></span><br><span class="line">reduce(<span class="keyword">lambda</span> x, y: x * y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>) <span class="comment"># ((((5 * 1) * 2) * 3)) * 4</span></span><br></pre></td></tr></table></figure>

<p><img data-src="/2019/05/18/index/reduce2.png" alt="类比一下"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 计算 5!+4!+3!+2!+1!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">addFactorial</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="meta">... </span>    result = []</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> map(<span class="keyword">lambda</span> x:x + <span class="number">1</span>, range(n)):</span><br><span class="line"><span class="meta">... </span>        a = reduce(<span class="keyword">lambda</span> x, y:x * y, map(<span class="keyword">lambda</span> x:x + <span class="number">1</span>, range(i)))</span><br><span class="line"><span class="meta">... </span>        result.append(a)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y:x + y, result)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>addFactorial(<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>addFactorial(<span class="number">3</span>)</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="第二部分-闭包"><a href="#第二部分-闭包" class="headerlink" title="第二部分 闭包"></a>第二部分 闭包</h3><p>接下来的内容涉及函数相关内容，之前的两篇文章<br><a href="https://mp.weixin.qq.com/s/g8P8IT3_eK5KYlyWIXKgbQ" target="_blank" rel="noopener">Python 基础系列–函数【9】</a><br><a href="https://mp.weixin.qq.com/s/93jGABTI5DEDxCT4iUT3pw" target="_blank" rel="noopener">Python 基础系列之作用域【10】</a></p>
<p><img data-src="/2019/05/18/index/func.png" alt="函数概述图"></p>
<blockquote>
<p>函数是对象，函数可以作为返回值，</p>
</blockquote>
<p>在说闭包定义之前，我们先看下开头的那两段代码</p>
<h4 id="1-初始闭包"><a href="#1-初始闭包" class="headerlink" title="1. 初始闭包"></a>1. 初始闭包</h4><blockquote>
<p>函数是对象，函数可以作为返回值。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第二题</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_counter</span><span class="params">()</span>:</span></span><br><span class="line">  i = <span class="number">10</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(x=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">nonlocal</span> i</span><br><span class="line">    i += x</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> count</span><br><span class="line">a_count = new_counter()</span><br><span class="line">print(a_count())</span><br><span class="line">print(a_count())</span><br><span class="line">print(a_count(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>
<p><img data-src="/2019/05/18/index/bibao.jpg" alt="闭包"></p>
<p>上侧的例子主要实现的是一个<strong>计数器的功能</strong>：<code>每点击一次，在原基础上加1</code>;</p>
<p>结合上图，大致了解下流程：</p>
<ul>
<li>函数定于与返回：<ul>
<li>外层函数new_counter返回了内层函数count作为结果；</li>
<li>内层函数count，中的参数：<strong>x</strong>有个默认值1；</li>
<li>内层函数count中的 i 利用了nonlocal，获取到10；</li>
</ul>
</li>
<li>a_count = new_counter()<ul>
<li>将变量a_count指向new_counter()返回的count()</li>
<li>count()的type为func,并且i持有10对应的内存地址</li>
</ul>
</li>
<li>第一次调用a_count()时<ul>
<li>没有参数，x默认为1;</li>
<li>i持有10，经过➕后返回11</li>
</ul>
</li>
<li>第二次调用a_count()时<ul>
<li>没有参数，x默认为1;</li>
<li>i持有11，经过➕后返回12</li>
</ul>
</li>
<li>第二次调用a_count()时<ul>
<li>没有参数，x=3;</li>
<li>i持有12，经过➕后返回15</li>
</ul>
</li>
</ul>
<p>此时我不确定看了上图和说明，是否<strong>能够看懂闭包的用法</strong></p>
<h4 id="2-闭包的定义"><a href="#2-闭包的定义" class="headerlink" title="2 闭包的定义"></a>2 闭包的定义</h4><blockquote>
<p>比较晦涩的专业术语，但还是建议认真读读</p>
<blockquote>
<p>都是大神发明的东西</p>
</blockquote>
<blockquote>
<p>真的很巧妙</p>
</blockquote>
</blockquote>
<p><strong>下边的文字值得读 N 遍</strong></p>
<p><code>维基百科上对闭包的解释就很经典：</code></p>
<p>在计算机科学中，<strong>闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。</strong><br>所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。 Peter J. Landin 在1964年将术语闭包定义为一种包含环境成分和控制成分的实体。</p>
<ul>
<li>闭包概念:<ul>
<li>闭包就是有权访问另一个函数作用域中变量的函数.</li>
</ul>
</li>
<li>分析这句话:<ol>
<li>闭包是定义在函数中的函数.</li>
<li>闭包能访问包含函数的变量.</li>
<li>闭包携带状态包<ul>
<li>即使包含函数执行完了, 被闭包引用的变量也得不到释放.</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>接下来看第二个例子</p>
<h4 id="3-闭包的作用域"><a href="#3-闭包的作用域" class="headerlink" title="3. 闭包的作用域"></a>3. 闭包的作用域</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第三题</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeActions</span><span class="params">()</span>:</span></span><br><span class="line">    acts = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        acts.append(<span class="keyword">lambda</span> x: i ** x)</span><br><span class="line">    <span class="keyword">return</span> acts</span><br><span class="line">acts = makeActions()</span><br><span class="line">print(acts[<span class="number">0</span>](<span class="number">2</span>))</span><br><span class="line">print(acts[<span class="number">1</span>](<span class="number">2</span>))</span><br><span class="line">print(acts[<span class="number">2</span>](<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p><img data-src="/2019/05/18/index/bibao2.jpg" alt="闭包2"></p>
<p>当执行结束<code>acts = makeActions()</code>这一行代码。</p>
<ol>
<li>makeActions()函数内部【i】持有了 2,并且不释放；</li>
<li>acts实际包含了三个函数类型的内容</li>
<li>当调用<code>acts[x](2)</code>, 实际执行函数为<strong>lambda x: i ** x</strong>，而<code>i持有2</code></li>
<li>故当 y 一致时，x 的位置变化不影响结果，（acts[x] (y)）</li>
</ol>
<h4 id="4-加深一点"><a href="#4-加深一点" class="headerlink" title="4 加深一点"></a>4 加深一点</h4><p>如果我们就是要<code>错误的结果</code>，【0，1，8】呢？<br>如何去实现？</p>
<p>还记得在前面🈶个状态的概念吗？</p>
<ul>
<li>携带状态的闭包的概念<ul>
<li>即使包含函数执行完了, 被闭包引用的变量也得不到释放.</li>
</ul>
</li>
</ul>
<blockquote>
<p>思路：假如我们把列表中的位置对应i的状态保存起来，那就不就完事了么？</p>
</blockquote>
<blockquote>
<p>如果真的从头看到现在，并且一路思考，想必已经花费你不少时间了。</p>
<blockquote>
<p>此时的你应该完全理解文中阐述的内容了。</p>
</blockquote>
<blockquote>
<p>相对真正掌握知识而言，付出的时间的价值是翻倍的</p>
</blockquote>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeActions</span><span class="params">()</span>:</span></span><br><span class="line">    acts = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">(param)</span>:</span></span><br><span class="line">            newParam = <span class="keyword">lambda</span> x: param ** x</span><br><span class="line">            <span class="keyword">return</span> newParam</span><br><span class="line">        acts.append(g(i))</span><br><span class="line">    <span class="keyword">return</span> acts</span><br><span class="line">acts = makeActions()</span><br><span class="line">print(acts[<span class="number">0</span>](<span class="number">2</span>))</span><br><span class="line">print(acts[<span class="number">1</span>](<span class="number">2</span>))</span><br><span class="line">print(acts[<span class="number">2</span>](<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p><img data-src="/2019/05/18/index/bibao3.jpg" alt="第一次保留的状态"><br><img data-src="/2019/05/18/index/bibao4.jpg" alt="三种状态"></p>
<h4 id="5-再深入一些"><a href="#5-再深入一些" class="headerlink" title="5 再深入一些"></a>5 再深入一些</h4><p>这段代码能让你想到什么❓<br>最直观的就是：这个是个闭包</p>
<p>但是：这段代码万万不能让我联想到：<strong>直线方程</strong>、<strong>斜率</strong>、<strong>截距</strong>、<strong>坐标系</strong>等等的概念。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 第一种写法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">line_conf</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">line</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a*x + b</span><br><span class="line">    <span class="keyword">return</span> line</span><br><span class="line"></span><br><span class="line">line1 = line_conf(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">line2 = line_conf(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">print(line1(<span class="number">5</span>), line2(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种写法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">line_conf</span><span class="params">(a, b, x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a*x + b</span><br><span class="line">line_conf(<span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">line_conf(<span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>当我们明白了：<code>函数是对象</code>、<code>函数可以作为返回值</code>、<code>闭包携带状态</code>等等的概念后，可能会思考</p>
<ol>
<li>为何会有这种东西存在❓</li>
<li>究竟其用途是什么❓</li>
</ol>
<p>关于这个疑问，在所搜大量数据的时候，发现了<a href="https://www.zhihu.com/question/34872127/answer/60297928" target="_blank" rel="noopener">知乎上有个有意思的问答</a></p>
<blockquote>
<p><a href="https://www.zhihu.com/question/34872127/answer/60297928" target="_blank" rel="noopener">以下摘录其中的一部分</a></p>
</blockquote>
<ol>
<li><p><strong>简短答案</strong>：前者更具有可读性和可移植性。</p>
</li>
<li><p><strong>较完整答案</strong>：闭包（closure）和类（class）有相通之处，带有面向对象的<code>封装思维</code>。而面向对象编程正是为了更佳的可读性和更关键的可移植性；不过这个例子没太体现出面向对象的额外优势。</p>
</li>
<li><p><strong>升级答案</strong>：题主问出这个问题，很可能是现在<code>流行的编程教材知其然不知其所然的风格带来的恶果</code>。如果未来带着这个想法进入IT行业，会非常不适应公司的代码规范等基础要求；即便不入行只是自己写写程序用，也会和很多优秀、可复用等的理念失之交臂。</p>
</li>
<li><p>我认为一本优秀的教材除了讲基础语法，应该尽量教你代码<code>为什么这么写好</code>、<code>那么写不好</code>、那么那么写现在能用但<code>多半以后会出事</code>。</p>
</li>
</ol>
<blockquote>
<p><a href="https://www.zhihu.com/question/34872127/answer/60297928" target="_blank" rel="noopener">以上为摘录其中的一部分</a></p>
</blockquote>
<h3 id="我们所讨厌的行为，却是自己的所作所为。"><a href="#我们所讨厌的行为，却是自己的所作所为。" class="headerlink" title="我们所讨厌的行为，却是自己的所作所为。"></a><strong>我们所讨厌的行为，却是自己的所作所为。</strong></h3><h3 id="多问问什么，也许有一天，那些望而生畏会变成理所当然。"><a href="#多问问什么，也许有一天，那些望而生畏会变成理所当然。" class="headerlink" title="多问问什么，也许有一天，那些望而生畏会变成理所当然。"></a><strong>多问问什么，也许有一天，那些望而生畏会变成理所当然。</strong></h3><p>参考链接<br><a href="http://www.bubuko.com/infodetail-2316064.html" target="_blank" rel="noopener">Python 函数之lambda、map、filter和reduce</a><br><a href="https://my.oschina.net/cloudcoder/blog/226461" target="_blank" rel="noopener">内置函数的使用</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/16/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/16/index/" class="post-title-link" itemprop="url">Python基础系列之作用域【10】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-16 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-16T10:38:59+08:00">2019-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.6k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>尽量掌握 Python 命名空间、作用域</li>
<li>掌握 Python 匿名函数</li>
</ol>
<blockquote>
<p>本文本属于那种</p>
<blockquote>
<p>只可意会不可言传的范畴</p>
</blockquote>
</blockquote>
<p>原因:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. 大部分人都直接开撸，因为和想象差不多；</span><br><span class="line">2. 不容易说明白, 除非遇到bug了，断点调试。</span><br></pre></td></tr></table></figure>
<h3 id="第一部分-命名空间"><a href="#第一部分-命名空间" class="headerlink" title="第一部分 命名空间"></a>第一部分 命名空间</h3><blockquote>
<p>听起来高大上的词汇，或许是简单的.</p>
</blockquote>
<p><strong>在理解这个词汇钱，先看一个示例</strong></p>
<p>A 公司有个员工 A1，工号 001；<br>B 公司有个员工 B1，工号 001；</p>
<p>为何工资不会发错？</p>
<p><strong>这不废话么？</strong></p>
<p>原因在于：虽有同样的工号，但是相对而言的，在不同的公司（<code>空间</code>）内。</p>
<h4 id="1-定义"><a href="#1-定义" class="headerlink" title="1.定义"></a>1.定义</h4><p><strong>命名空间（英语：Namespace）</strong>，也称名字空间、名称空间等，它表示着一个<code>标识符（identifier）的可见范围</code>。<br>一个标识符可在多个名字空间中定义，它在不同名字空间中的含义是<code>互不相干的</code>。这样，在一个新的名字空间中可定义任何标识符，它们不会与任何已有的标识符发生冲突，因为已有的定义都处于其他名字空间中。</p>
<p><strong>空间</strong>相当于一个<code>集合</code>，<code>包含</code>相对相对范围内所有的内容(<strong>对象名</strong>)</p>
<h4 id="2-分类"><a href="#2-分类" class="headerlink" title="2. 分类"></a>2. 分类</h4><ol>
<li>内置命名空间(Built-in Namespaces)：伴随 Python 的运行而存在，<code>内置函数的命名空间</code>都属于<code>内置命名空间</code>，比如前面的 id()，直接可以用。</li>
<li>全局命名空间(Module:Global Namespaces)：每个模块拥有自己的命名集合；</li>
<li>本地命名空间(Function&amp;Class: Local Namespaces)：局部命名空间，每个函数、类所拥有的命名空间，记录了函数、类中定义的所有变量。</li>
</ol>
<blockquote>
<p>一图胜前言</p>
</blockquote>
<p><img data-src="1.jpg" alt="命名空间"></p>
<h4 id="3-生命周期"><a href="#3-生命周期" class="headerlink" title="3. 生命周期"></a>3. 生命周期</h4><ol>
<li>内置命名空间在 Python<code>解释器启动时创建</code>，解释器<code>退出时销毁</code>；</li>
<li>全局命名空间在模块被解释器<code>读入时创建</code>，<code>解释器退出时销毁</code>；</li>
<li>局部命名空间，包含函数、类定义。<ul>
<li>函数的局部命名空间：在函数调用时创建，函数返回结果或抛出异常时被销毁（每一个递归函数都拥有自己的命名空间）；</li>
<li>类定义的命名空间：在解释器读到类定义（class 关键字）时创建，类定义结束后销毁。（*）</li>
</ul>
</li>
</ol>
<h4 id="4-存在的意义"><a href="#4-存在的意义" class="headerlink" title="4. 存在的意义"></a>4. 存在的意义</h4><p>为了解决命名冲突。</p>
<p>你去寄快递，说邮寄到<strong>南京路 118 号</strong>，他肯定会让你写上是哪个省的，否则不就乱了么。</p>
<h3 id="第二部分-作用域"><a href="#第二部分-作用域" class="headerlink" title="第二部分 作用域"></a>第二部分 作用域</h3><h4 id="1-作用域是什么？"><a href="#1-作用域是什么？" class="headerlink" title="1. 作用域是什么？"></a>1. 作用域是什么？</h4><blockquote>
<p>可能有点绕，多读几遍，多思考下</p>
<p>可能有点绕，多读几遍，多思考下</p>
</blockquote>
<p>命名空间是<code>对象名称</code>的<strong>集合</strong>,可被访问区域，比如 id(),可以全局<strong>被调用</strong><br>作用域是针对命名空间而言的，是<strong>作用域定义了命名空间的可用范围</strong></p>
<p>以下注意事项会在第三部分的代码中证实：</p>
<ol>
<li>只有函数、类、模块会产生新的作用域，代码块（例如if、for代码块）不会产生新的作用域。</li>
<li>python中变量的作用域是由它在源代码中的位置决定的（*）</li>
</ol>
<p>先看下分类，然后进一步阐述<strong>命名空间与作用域的关系</strong></p>
<h4 id="2-分类-1"><a href="#2-分类-1" class="headerlink" title="2. 分类"></a>2. 分类</h4><ol>
<li>Local（局部作用域）：首先搜索，包含局部名字的最内层（innermost）作用域，如函数/方法/类的内部局部作用域；</li>
<li>Enclosing（ 闭包函数外的函数中）：根据嵌套层次从内到外搜索，包含非局部（nonlocal）非全局（nonglobal）名字的任意封闭函数的作用域。如两个嵌套的函数，内层函数的作用域是局部作用域，外层函数作用域就是内层函数的 Enclosing 作用域；</li>
<li>Global（全局作用域<br>）：倒数第二次被搜索，包含当前模块全局名字的作用域；</li>
<li>Built-in（内建作用域）：最后被搜索，包含内建名字的最外层作用域。</li>
</ol>
<p><strong>查找规则</strong></p>
<p><img data-src="2.jpg" alt="如图所示"></p>
<blockquote>
<p>内层可以访问外层，但外层不能访问内层</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">global_var = <span class="number">2</span>  <span class="comment"># 全局作用域</span></span><br><span class="line">x = id(global_var)  <span class="comment"># 内建作用域，调用id()函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">()</span>:</span></span><br><span class="line">    out_var = <span class="number">1</span>  <span class="comment"># 闭包函数外的函数中</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        inner_var = <span class="number">2</span>  <span class="comment"># 局部作用域</span></span><br></pre></td></tr></table></figure>

<h4 id="3-关系"><a href="#3-关系" class="headerlink" title="3. 关系"></a>3. 关系</h4><p><del>尽量用自己的理解去阐述明白，如有不对，敬请指正。</del></p>
<p><del>第一阶段：在人类诞生初期，是没有族群、部落、国家之分的，此时相当于全人类都是属于一个<strong>人类的集合</strong>，此时的<strong>人类</strong>相当于<strong>一个人类</strong>，没有高低贵贱黑白美丑之分。</del></p>
<p><del>第二阶段：族群的出现，代表着某些人有用自己的势力范围，把人类一个整体分为N个族群</del></p>
<h3 id="第三部分-函数作用域"><a href="#第三部分-函数作用域" class="headerlink" title="第三部分 函数作用域"></a>第三部分 函数作用域</h3><p>上一篇是关于<strong>函数的</strong>，那就以函数作用域为实例，类、模块都是类似的。</p>
<h4 id="1-整体的例子"><a href="#1-整体的例子" class="headerlink" title="1. 整体的例子"></a>1. 整体的例子</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="number">1</span></span><br><span class="line">print(<span class="string">"第一步：x的内存地址： "</span>, id(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">2</span></span><br><span class="line">    <span class="comment"># 同层 x=2</span></span><br><span class="line">    print(<span class="string">"第二步：x的内存地址： "</span>, id(x))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        x = <span class="number">3</span></span><br><span class="line">        <span class="comment"># 打印同层 x=3</span></span><br><span class="line">        print(<span class="string">"第三步：x的内存地址： "</span>, id(x))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner_up</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># 打印上层 x=2</span></span><br><span class="line">        print(<span class="string">"第三步(up)：x的内存地址： "</span>, id(x))</span><br><span class="line">    inner()</span><br><span class="line">    inner_up()</span><br><span class="line">    <span class="comment"># 打印的是同层x=2，即outer()下侧的同一作用域的x</span></span><br><span class="line">    print(<span class="string">"第四步：x的内存地址： "</span>, id(x))</span><br><span class="line">outer()</span><br><span class="line">print(<span class="string">"第五步：x的内存地址： "</span>, id(x))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python3 fun.py </span><br><span class="line">第一步：a的内存地址：  <span class="number">4336156688</span></span><br><span class="line">第二步：x的内存地址：  <span class="number">4336156720</span></span><br><span class="line">第三步：x的内存地址：  <span class="number">4336156752</span></span><br><span class="line">第三步(up)：x的内存地址：  <span class="number">4336156720</span></span><br><span class="line">第四步：x的内存地址：  <span class="number">4336156720</span></span><br><span class="line">第五步：x的内存地址：  <span class="number">4336156688</span></span><br></pre></td></tr></table></figure>

<h4 id="2-nonlocal和global区别"><a href="#2-nonlocal和global区别" class="headerlink" title="2. nonlocal和global区别"></a>2. nonlocal和global区别</h4><ol>
<li>global关键字：用来在函数或其它局部作用域中<strong>使用全局变量</strong>。</li>
<li>nonlocal关键字：用来在函数或其它作用域中使用外层（非全局）变量</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="number">1</span></span><br><span class="line">print(<span class="string">"第一步：x的内存地址： "</span>, id(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">2</span></span><br><span class="line">    print(<span class="string">"第二步：x的内存地址： "</span>, id(x))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># 注意这行</span></span><br><span class="line">        <span class="keyword">global</span> x</span><br><span class="line">        x = <span class="number">3</span></span><br><span class="line">        print(<span class="string">"第三步：x的内存地址： "</span>, id(x))</span><br><span class="line">    inner()</span><br><span class="line">    print(<span class="string">"第四步：x的内存地址： "</span>, id(x))</span><br><span class="line">outer()</span><br><span class="line">print(<span class="string">"第五步：x的内存地址： "</span>, id(x))</span><br></pre></td></tr></table></figure>

<p>针对outer中x的：</p>
<ol>
<li><p>采用global的结果<br><img data-src="20.png" alt="global"></p>
</li>
<li><p>采用nonlocal的结果<br><img data-src="30.png" alt="nonlocal"></p>
</li>
</ol>
<h4 id="3-作用域的位置"><a href="#3-作用域的位置" class="headerlink" title="3. 作用域的位置"></a>3. 作用域的位置</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name &#x3D;&#39;简单即是美&#39;</span><br><span class="line"></span><br><span class="line">def f1():</span><br><span class="line">    print(name)</span><br><span class="line"></span><br><span class="line">def f2():</span><br><span class="line">    name &#x3D; &#39;Python&#39;</span><br><span class="line">    f1()</span><br><span class="line">f2()</span><br></pre></td></tr></table></figure>

<p><strong>Python函数的作用域取决于其函数代码块在整体代码中的位置，</strong>而不是调用时机的位置。调用f1的时候，会去f1函数的定义体查找，对于f1函数，它的外部是name=’简单即是美’，而不是name = ‘Python’。</p>
<p><strong>结果</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">简单即是美</span><br></pre></td></tr></table></figure>

<p>倒数第二步<br><img data-src="31.png" alt="倒数第二步"></p>
<p>参考链接</p>
<p><a href="https://www.linuxidc.com/Linux/2018-12/155918.htm" target="_blank" rel="noopener">Python 中命名空间与作用域使用总结</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/15/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/15/index/" class="post-title-link" itemprop="url">Python基础系列之--函数【9】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-15 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-15T10:38:59+08:00">2019-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.7k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>掌握 Python 函数–定义、参数类型</li>
<li>掌握 Python 函数–变量作用域</li>
</ol>
<blockquote>
<p>正确理解 Python 函数，能够更好地理解 <strong>Python 装饰器、匿名函数（lambda）、函数式编程</strong>等高阶技术。</p>
</blockquote>
<p>文章较长，整体内容包含如下思维导图</p>
<p><img data-src="func.png" alt="概述"></p>
<h3 id="第一部分-重新认识函数"><a href="#第一部分-重新认识函数" class="headerlink" title="第一部分 重新认识函数"></a>第一部分 重新认识函数</h3><h4 id="1-定义"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义</h4><p>Python 中函数的定义如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 函数名<span class="params">(参数)</span>:</span></span><br><span class="line">    <span class="comment"># 内部代码</span></span><br><span class="line">    <span class="keyword">return</span> 表达式</span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ol>
<li>函数代码块以<code>def关键词</code>开头，一个空格之后接<code>函数标识符名称</code>和<code>圆括号()</code>，再接个<code>冒号</code>。</li>
<li>圆括号中间存放参数</li>
<li>使用 return 结束函数。默认返回 None。</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(a, b)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a + b</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum</span><br><span class="line"><span class="comment"># 函数地址</span></span><br><span class="line">&lt;function sum at <span class="number">0x10af4f158</span>&gt;</span><br><span class="line"><span class="comment">## 函数方法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(sum)</span><br><span class="line">[<span class="string">'__annotations__'</span>, <span class="string">'__call__'</span>, <span class="string">'__class__'</span>, <span class="string">'__closure__'</span>, <span class="string">'__code__'</span>, <span class="string">'__defaults__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__get__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__globals__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__kwdefaults__'</span>, <span class="string">'__le__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__name__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__qualname__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum.__name__</span><br><span class="line"><span class="string">'sum'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum.__module__</span><br><span class="line"><span class="string">'__main__'</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-调用函数"><a href="#2-调用函数" class="headerlink" title="2 调用函数"></a>2 调用函数</h4><p>使用函数名后跟圆括号的方式调用函数。<br>调用的同时要根据函数的定义体，提供<code>相应个数和类型的参数</code>，每个参数之间用逗号分隔。</p>
<h4 id="3-函数是对象"><a href="#3-函数是对象" class="headerlink" title="3. 函数是对象"></a>3. 函数是对象</h4><p><strong>在 Python 中万物皆为对象</strong>，函数也不例外，</p>
<ol>
<li>可以作为对象可以赋值给一个变量</li>
<li>可以作为元素添加到集合对象中</li>
<li>可作为参数值传递给其它函数</li>
<li>可以当做函数的返回值</li>
</ol>
<blockquote>
<p>函数身为一个对象，拥有对象模型的三个通用属性：<strong>id、类型、和值。</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a + b</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(add)</span><br><span class="line"><span class="number">4472644200</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(add)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">function</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">add</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">add</span> <span class="title">at</span> 0<span class="title">x10a972268</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>变量赋值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>newAdd = add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>newAdd(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add <span class="keyword">is</span> newAdd</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>其实上侧的，只是不同的名字指向同一个内存地址，同时这块地址被多次引用。</p>
<p><img data-src="1.jpg" alt="变量"></p>
<blockquote>
<p>了解了函数是对象，以及上侧的几个性质，更得牢记一切都是对象。<br>既然是对象，性质都类似，其余的集合、参数、返回值，思考下就明白了</p>
</blockquote>
<h3 id="第二部分-参数类型"><a href="#第二部分-参数类型" class="headerlink" title="第二部分 参数类型"></a>第二部分 参数类型</h3><p>其实就是下侧那个括号里的数据，但是需要注意的是，<code>传的是什么</code>，<code>怎么传</code></p>
<p><strong>定义</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 函数名<span class="params">(参数)</span>:</span></span><br><span class="line">    <span class="comment"># 内部代码</span></span><br><span class="line">    <span class="keyword">return</span> 表达式</span><br></pre></td></tr></table></figure>

<p><strong>完整的语法</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">func(positional_args, keyword_args, *tuple_nonkw_args, **dict_kw_args)</span><br></pre></td></tr></table></figure>

<p><strong>函数的参数的分类</strong></p>
<ol>
<li>位置参数(必选参数)</li>
<li>默认参数</li>
<li>可变参数 *args</li>
<li>可变参数 **kwargs</li>
<li>必选参数</li>
</ol>
<h4 id="1-位置参数"><a href="#1-位置参数" class="headerlink" title="1. 位置参数"></a>1. 位置参数</h4><p>定义：<code>调用</code>时候的传的<code>参数</code>必须与<code>定义</code>时的<code>参数</code>一一对应。<br>注意事项：<br>不能多也不能少。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(a, b)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="comment"># 一一对应</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sum(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="comment"># 参数缺失</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sum(<span class="number">1</span>))</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: sum() missing <span class="number">1</span> required positional argument: <span class="string">'b'</span></span><br><span class="line"><span class="comment"># 关键字参数,顺序不重要，存在即可</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sum(b=<span class="number">10</span>, a=<span class="number">4</span>))</span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure>

<h4 id="2-默认值"><a href="#2-默认值" class="headerlink" title="2. 默认值"></a>2. 默认值</h4><p>定义：在函数声明的时候，可以给某个参数指定默认值<br>注意事项：<br>位置：需要放在<code>位置参数</code>之后</p>
<p><strong>默认参数需要在位置参数的后边</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">power</span><span class="params">(x, n = <span class="number">2</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x**n</span><br><span class="line">ret1 = power(<span class="number">10</span>)   <span class="comment"># 使用默认的参数值n=2</span></span><br><span class="line">ret2 = power(<span class="number">10</span>, <span class="number">4</span>)  <span class="comment"># 将4传给n，实际计算10**4的值</span></span><br><span class="line">ret3 = power(n=<span class="number">1</span>, x=<span class="number">100</span>) <span class="comment"># 指定参数名传值</span></span><br></pre></td></tr></table></figure>

<p><strong>来个例子</strong><br>主要涉及：内存地址、参数默认值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a=[])</span>:</span></span><br><span class="line">    a.append(<span class="string">"A"</span>)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">print(func())</span><br><span class="line">print(func())</span><br><span class="line">print(func())</span><br></pre></td></tr></table></figure>

<p><strong>三思</strong><br><strong>三思</strong><br><strong>三思</strong></p>
<p>答案如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">'A'</span>]</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'A'</span>]</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'A'</span>, <span class="string">'A'</span>]</span><br></pre></td></tr></table></figure>

<p>如果真正理解了，Python 对象的<strong>变量名与内存地址</strong>,这个问题还是很简单的。</p>
<ol>
<li>默认参数 a 指向的空列表对象就会被创建，假如内存地址为<code>0x123</code>;</li>
<li>之后每次调用，都会在原地址后追加<code>A</code>;</li>
<li>可以试着在函数内部打印 a 的内存地址，应该是一致的。</li>
</ol>
<blockquote>
<p>如何避免这种操作？</p>
<blockquote>
<p>让 a 的默认值指向一个<strong>不可变对象即可</strong>，如：数字、None 等</p>
</blockquote>
</blockquote>
<h4 id="3-可变参数-args"><a href="#3-可变参数-args" class="headerlink" title="3. 可变参数 *args"></a>3. 可变参数 *args</h4><p>在 python 里面，函数在声明的时候，参数中可以使用(<em>变量名)的方式来接受<code>不确定长度的参数</code>，但是在 python 里面大家约定俗成使用`</em>args<code>接受不定长参数，之后将这些参数放到一个</code>tuple`里面，可以通过访问 args 来获取这些不定长参数。</p>
<p><code>例子一</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">changeFunc</span><span class="params">(*args)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(type(args))</span><br><span class="line"><span class="meta">... </span>    print(args)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>changeFunc(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="number">3</span>)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">3</span>)</span></span></span><br></pre></td></tr></table></figure>

<p><code>例子二</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>changeFunc([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="number">3</span>])</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="params">([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">3</span>],)</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>为何打印出来是这样？<br>因为是数组是作为一个整体传过来的。<br>如何将 list 的元素转换为 tuple 的元素？结果与例子一一致？</p>
</blockquote>
<p><strong>答案：</strong> 参数前加个星号,<a href="https://docs.python.org/2/tutorial/controlflow.html#unpacking-argument-lists" target="_blank" rel="noopener">解压参数列表</a>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tmpList = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(*tmpList)</span><br><span class="line">a b <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(tmpList)</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment"># 调用函数时，数组➕星号，解压参数列表</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>changeFunc(*tmpList)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">3</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>当参数已经在<code>列表或元组中</code>但需要为需要单独位置参数的函数, 需要解压参数, 然后再一一传进去</p>
<p>针对字典带上*号，解压的是 key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict = &#123;<span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="number">2</span>, <span class="string">"c"</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(*dict)</span><br><span class="line">a b c</span><br></pre></td></tr></table></figure>

<h4 id="4-可变参数-args"><a href="#4-可变参数-args" class="headerlink" title="4. 可变参数 *args"></a>4. 可变参数 *args</h4><p>定义：<code>*args</code>参数表示未知的位置参数序列长度，而<code>\*\*kwargs</code>代表包含<strong>关键字和值映射关系的字典</strong>，它可以包含任意数量的关键字和值映射，并且在函数定义中“*args”必须位于“**kwargs”前面。</p>
<blockquote>
<p>*args 必须在**kwargs 之前。<br>默认值参数必须再必选参数之前。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">kwargs</span><span class="params">(first, second=<span class="number">2</span>, *args, **kwargs)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(first, second)</span><br><span class="line"><span class="meta">... </span>    print(args)</span><br><span class="line"><span class="meta">... </span>    print(kwargs)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># kwargs为空是因为被*args吃掉了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kwargs(<span class="number">1</span>, <span class="number">3</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, &#123;<span class="string">"key1"</span>: <span class="string">"value"</span>&#125;)</span><br><span class="line"><span class="number">1</span> <span class="number">3</span></span><br><span class="line">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, &#123;<span class="string">'key1'</span>: <span class="string">'value'</span>&#125;)</span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict = &#123;<span class="string">"key1"</span>: <span class="string">"value"</span>&#125;</span><br><span class="line"><span class="comment"># 解压参数，</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kwargs(<span class="number">1</span>, <span class="number">3</span>, *list, **dict)</span><br><span class="line"><span class="number">1</span> <span class="number">3</span></span><br><span class="line">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)</span><br><span class="line">&#123;<span class="string">'key1'</span>: <span class="string">'value'</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 后边不能追加参数了。。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(**kw, error)</span>:</span></span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(**kw, error)</span>:</span></span><br><span class="line">                       ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>

<h4 id="5-关键字参数"><a href="#5-关键字参数" class="headerlink" title="5. 关键字参数"></a>5. 关键字参数</h4><blockquote>
<p>位置参数可以不带参数名，但是星号后边的就必选带上参数名</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 星号后必选加上参数名字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(loction, second, *, must)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(loction, second, must)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: func() takes <span class="number">2</span> positional arguments but <span class="number">3</span> were given</span><br><span class="line"><span class="comment"># 符合预期</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(<span class="number">1</span>, <span class="number">2</span>, must=<span class="number">3</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p><strong>来一个汇总的骚操作</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">student</span><span class="params">(name, age=<span class="number">18</span>, *args, sex, classroom, **kwargs)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(name, age, args, sex, classroom, kwargs)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># *args 之后的一般参数默认更改为关键字参数，sex/classroom未传递，报错</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>student(<span class="string">"howard"</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: student() missing <span class="number">2</span> required keyword-only arguments: <span class="string">'sex'</span> <span class="keyword">and</span> <span class="string">'classroom'</span></span><br><span class="line"><span class="comment"># 位置参数与关键字参数【必选】，可选参数【可选】</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>student(<span class="string">"howard"</span>, sex=<span class="string">"1"</span>, classroom=<span class="string">"python"</span>)</span><br><span class="line">howard <span class="number">10</span> () <span class="number">1</span> python &#123;&#125;</span><br><span class="line"><span class="comment"># dict</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict</span><br><span class="line">&#123;<span class="string">'key1'</span>: <span class="string">'value'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>student(<span class="string">"howard"</span>, sex=<span class="string">"1"</span>, classroom=<span class="string">"python"</span>, **dict)</span><br><span class="line">howard <span class="number">10</span> () <span class="number">1</span> python &#123;<span class="string">'key1'</span>: <span class="string">'value'</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="本文重点注意事项："><a href="#本文重点注意事项：" class="headerlink" title="本文重点注意事项："></a>本文重点注意事项：</h3><ol>
<li>牢记函数为第一类对象；</li>
<li>可选参数注意解压参数；</li>
</ol>
<p>参考<br><a href="https://www.zhihu.com/question/25950466" target="_blank" rel="noopener">函数作为参数的问题</a><br><a href="http://python.jobbole.com/81646/" target="_blank" rel="noopener">Python 中的函数详解</a><br><a href="http://python.jobbole.com/81646/" target="_blank" rel="noopener"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/14/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/14/index/" class="post-title-link" itemprop="url">Node.js基础系列之Http模块【5】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-14 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-14T10:38:59+08:00">2019-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 14:43:26" itemprop="dateModified" datetime="2020-05-28T14:43:26+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index"><span itemprop="name">Node</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul>
<li>掌握Node.js核心模块之网络模块</li>
</ul>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-c6a6ee0a6a22f108.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="文章目录"></p>
<blockquote>
<p>Node.js标准库提供了 http 模块，是Node.js中非常重要的一个核心模块。</p>
</blockquote>
<p>通过http模块，你可以使用其http.createServer方法创建一个<code>http服务器</code>，也可以使用其http.request方法创建一个<code>http客户端。</code></p>
<h3 id="第一部分-http服务端"><a href="#第一部分-http服务端" class="headerlink" title="第一部分: http服务端"></a>第一部分: http服务端</h3><h4 id="1-1-HTTP是什么"><a href="#1-1-HTTP是什么" class="headerlink" title="1.1 HTTP是什么?"></a>1.1 HTTP是什么?</h4><p>HTTP是一个用来传送数据的应用层协议，在其底层使用TCP传输协议。HTTP是互联网数据通信的基础，要响应客户端请求（如：浏览器访问），首先要布署HTTP服务器。</p>
<h4 id="1-2-HTTP之URL"><a href="#1-2-HTTP之URL" class="headerlink" title="1.2 HTTP之URL"></a>1.2 HTTP之URL</h4><p>URL: (Uniform / Universal Resource Locator，常缩写为URL)统一资源定位符,统一资源定位符的标准格式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">协议类型:&#x2F;&#x2F;服务器地址（必要时需加上端口号）&#x2F;路径&#x2F;文件名</span><br></pre></td></tr></table></figure>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-0ada86699d61295d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="http1-url-structure.png"></p>
<h4 id="1-3-http之请求报文"><a href="#1-3-http之请求报文" class="headerlink" title="1.3 http之请求报文"></a>1.3 http之请求报文</h4><p>一个HTTP请求报文由请求行（request line）、请求头部（header）、空行和请求数据4个部分组成;</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-f50e4e26dd6acfa8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2012072810301161.png"></p>
<p><strong>举例子:</strong></p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-cf0c5d48bf504245.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="201411187986714.png"></p>
<p>请求报文中关键的字段:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-Agent：产生请求的浏览器类型;</span><br><span class="line">Accept：客户端可识别的响应内容类型列表;星号 “ * ” 用于按范围将类型分组，用 “ *&#x2F;* ” 指示可接受全部类型，用“ type&#x2F;* ”指示可接受 type 类型的所有子类型;</span><br><span class="line">Accept-Language：客户端可接受的自然语言;</span><br><span class="line">Accept-Encoding：客户端可接受的编码压缩格式;</span><br><span class="line">Accept-Charset：可接受的应答的字符集;</span><br><span class="line">Host：请求的主机名，允许多个域名同处一个IP 地址，即虚拟主机;</span><br><span class="line">connection：连接方式(close 或 keepalive);</span><br><span class="line">Cookie：存储于客户端扩展字段，向同一域名的服务端发送属于该域的cookie;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-HTTP响应报文"><a href="#1-4-HTTP响应报文" class="headerlink" title="1.4 HTTP响应报文"></a>1.4 HTTP响应报文</h4><p>HTTP 响应报文由<code>状态行、响应头部、空行 和 响应包体</code> 4 个部分组成</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-7c6e79fa4c5d355a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="201446213766964.jpg"></p>
<p>状态代码由三位数字组成，第一个数字定义了响应的类别，且有五种可能取值。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1xx：指示信息--表示请求已接收，继续处理。</span><br><span class="line">2xx：成功--表示请求已被成功接收、理解、接受。</span><br><span class="line">3xx：重定向--要完成请求必须进行更进一步的操作。</span><br><span class="line">4xx：客户端错误--请求有语法错误或请求无法实现。</span><br><span class="line">5xx：服务器端错误--服务器未能实现合法的请求。</span><br></pre></td></tr></table></figure>

<p>常见的状态码:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">200 OK：客户端请求成功。</span><br><span class="line">400 Bad Request：客户端请求有语法错误，不能被服务器所理解。</span><br><span class="line">401 Unauthorized：请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用。</span><br><span class="line">403 Forbidden：服务器收到请求，但是拒绝提供服务。</span><br><span class="line">404 Not Found：请求资源不存在，举个例子：输入了错误的URL。</span><br><span class="line">500 Internal Server Error：服务器发生不可预期的错误。</span><br><span class="line">503 Server Unavailable：服务器当前不能处理客户端的请求，一段时间后可能恢复正常，举个例子：HTTP&#x2F;1.1 200 OK（CRLF）。</span><br></pre></td></tr></table></figure>




<h3 id="第二部分-http服务器端"><a href="#第二部分-http服务器端" class="headerlink" title="第二部分 http服务器端"></a>第二部分 http服务器端</h3><h4 id="1-1-http-server遵循了node-js的时间模块的规则-有触发和相应事件-http-Server对象是一个EventEmitter"><a href="#1-1-http-server遵循了node-js的时间模块的规则-有触发和相应事件-http-Server对象是一个EventEmitter" class="headerlink" title="1.1 http.server遵循了node.js的时间模块的规则, 有触发和相应事件;http.Server对象是一个EventEmitter;"></a>1.1 http.server遵循了node.js的时间模块的规则, 有触发和相应事件;http.Server对象是一个EventEmitter;</h4><p>创建: http.createServer方法会返回一个<code>http.Server对象实例</code>，requestListener可选参数传入时，将做为http.Server对象’request’事件的监听器。</p>
<p>http.Server对象提供的事件方法有:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. request: function (request, response) &#123; &#125;每次请求都会触发该方法;</span><br><span class="line">2. connection：当TCP连接建立时，该事件被触发，提供一个参数socket，是net.Socket的实例;</span><br><span class="line">3. close: 当此服务器关闭时触发;</span><br><span class="line">等等..</span><br></pre></td></tr></table></figure>

<h4 id="1-2-http-Server中的方法"><a href="#1-2-http-Server中的方法" class="headerlink" title="1.2 http.Server中的方法"></a>1.2 http.Server中的方法</h4><h5 id="2-2-1-server-listen-port-hostname-backlog-callback"><a href="#2-2-1-server-listen-port-hostname-backlog-callback" class="headerlink" title="2.2.1 server.listen(port[, hostname][, backlog][, callback])"></a>2.2.1 server.listen(port[, hostname][, backlog][, callback])</h5><p>在指定的主机名（hostname）和端口（port）开始接收连接, </p>
<h5 id="1-2-2-server-listen-path-callback"><a href="#1-2-2-server-listen-path-callback" class="headerlink" title="1.2.2 server.listen(path, [callback])"></a>1.2.2 server.listen(path, [callback])</h5><p>监听某个</p>
<h4 id="1-3-http-ServerResponse服务器响应对象"><a href="#1-3-http-ServerResponse服务器响应对象" class="headerlink" title="1.3 http.ServerResponse服务器响应对象"></a>1.3 http.ServerResponse服务器响应对象</h4><p>http.ServerResponse是一个由http.Server创建的对象, ，在触发’request’事件后，做事件回调函数的第二个参数传递给回调函数.</p>
<p><code>response.writeHead(statusCode[, statusMessage][, headers])</code></p>
<p>向客户端请求发送一个响应头。<br>statusCode状态码是 3 位数字，如：404。<br>statusMessage设置状态消息。<br>最后一个参数headers是响应头。</p>
<blockquote>
<p>这个方法只能在当前请求中使用一次，并且必须在response.end()之前调用。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var body &#x3D; &#39;hello world&#39;;</span><br><span class="line">response.writeHead(200, &#123;</span><br><span class="line">  &#39;Content-Length&#39;: body.length,</span><br><span class="line">  &#39;Content-Type&#39;: &#39;text&#x2F;plain&#39; &#125;);</span><br></pre></td></tr></table></figure>

<p><code>response.setHeader(name, value)</code></p>
<p>为默认或者已存在的头设置一条单独的头内容。如果这个头已经存在于 将被送出的头中，将会覆盖原来的内容。如果我想设置更多的头， 就使用一个相同名字的字符串数组</p>
<p><code>response.write(chunk, [encoding])</code><br>向响应流发送一个数据块。这个方法可能被调用多次，以提供响应体内容。</p>
<p><code>response.end([data], [encoding])</code></p>
<p>当所有的响应报头和报文被发送完成时这个方法将信号发送给服务器，服务器会认为这个消息完成了。 每次响应完成之后必须调用该方法。</p>
<h3 id="第三部分-http客户端"><a href="#第三部分-http客户端" class="headerlink" title="第三部分 http客户端"></a>第三部分 http客户端</h3><p>http模块提供了两个创建HTTP客户端的方法<code>http.request</code>和<code>http.get</code>，以向HTTP服务器发起请求。<code>http.get是http.request快捷方法</code>，该方法仅支持GET方式的请求。</p>
<p>一个 IncomingMessage对象是由 http.Server或http.ClientRequest创建的，并作为第一参数分别传递给’request’和’response’ 事件。它也可以被用来访问应答的状态，头文件和数据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var http &#x3D; require(&#39;http&#39;);</span><br><span class="line"></span><br><span class="line">http.createServer(function (req, res) &#123;</span><br><span class="line">  var content &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">  req.on(&#39;data&#39;, function (chunk) &#123;</span><br><span class="line">    content +&#x3D; chunk;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  req.on(&#39;end&#39;, function () &#123;</span><br><span class="line">    res.writeHead(200, &#123;&quot;Content-Type&quot;: &quot;text&#x2F;plain&quot;&#125;);</span><br><span class="line">    res.write(&quot;You&#39;ve sent: &quot; + content);</span><br><span class="line">    res.end();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;).listen(3000);</span><br></pre></td></tr></table></figure>

<p>data事件会在数据接收过程中，每收到一段数据就触发一次，接收到的数据被传入回调函数。end事件则是在所有数据接收完成后触发。</p>
<p><code>http.request(options[, callback])</code><br>request方法的options参数，可以是一个对象，也可以是一个字符串。如果是字符串，就表示这是一个URL，Node内部就会自动调用url.parse()，处理这个参数。</p>
<p>options对象可以设置如下属性:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">host：HTTP请求所发往的域名或者IP地址，默认是localhost。</span><br><span class="line">hostname：该属性会被url.parse()解析，优先级高于host。</span><br><span class="line">port：远程服务器的端口，默认是80。</span><br><span class="line">localAddress：本地网络接口。</span><br><span class="line">socketPath：Unix网络套接字，格式为host:port或者socketPath。</span><br><span class="line">method：指定HTTP请求的方法，格式为字符串，默认为GET。</span><br><span class="line">path：指定HTTP请求的路径，默认为根路径（&#x2F;）。可以在这个属性里面，指定查询字符串，比如&#x2F;index.html?page&#x3D;12。如果这个属性里面包含非法字符（比如空格），就会抛出一个错误。</span><br><span class="line">headers：一个对象，包含了HTTP请求的头信息。</span><br><span class="line">auth：一个代表HTTP基本认证的字符串user:password。</span><br><span class="line">agent：控制缓存行为，如果HTTP请求使用了agent，则HTTP请求默认为Connection: keep-alive，它的可能值如下：</span><br><span class="line">undefined（默认）：对当前host和port，使用全局Agent。</span><br><span class="line">Agent：一个对象，会传入agent属性。</span><br><span class="line">false：不缓存连接，默认HTTP请求为Connection: close。</span><br><span class="line">keepAlive：一个布尔值，表示是否保留socket供未来其他请求使用，默认等于false。</span><br><span class="line">keepAliveMsecs：一个整数，当使用KeepAlive的时候，设置多久发送一个TCP KeepAlive包，使得连接不要被关闭。默认等于1000，只有keepAlive设为true的时候，该设置才有意义。</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var http &#x3D; require(&#39;http&#39;);</span><br><span class="line">http.createServer(function(req, res)&#123;</span><br><span class="line">&#x2F;&#x2F;仅对从http.Server获得到的请求(request)有效.</span><br><span class="line">	console.log(req.url);</span><br><span class="line">	&#x2F;&#x2F;请求&#x2F;响应 头对象.</span><br><span class="line">	console.log(req.headers);</span><br><span class="line">	&#x2F;&#x2F;服务器的HTTP版本。</span><br><span class="line">	console.log(req.httpVersion);</span><br><span class="line">	&#x2F;&#x2F;接收到的原始请求&#x2F;响应头字段列表。</span><br><span class="line">	console.log(req.rawHeaders);</span><br><span class="line">	&#x2F;&#x2F;仅对从http.Server获得到的请求(request)有效.比如‘GET’、‘DELETE’。</span><br><span class="line">	console.log(req.method);</span><br><span class="line">&#125;).listen(3000, &#39;127.0.0.1&#39;);</span><br></pre></td></tr></table></figure>



<h3 id="第四部分-实例"><a href="#第四部分-实例" class="headerlink" title="第四部分 实例"></a>第四部分 实例</h3><h4 id="1-创建服务器-实现GET方法"><a href="#1-创建服务器-实现GET方法" class="headerlink" title="1 创建服务器, 实现GET方法"></a>1 创建服务器, 实现GET方法</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var http &#x3D; require(&#39;http&#39;);</span><br><span class="line">&#x2F;&#x2F;创建一个服务器, 回调函数的参数为响应, 和请求</span><br><span class="line">http.createServer(function(request, response)&#123;</span><br><span class="line">	&#x2F;&#x2F;response.writeHead方法用来写入HTTP回应的头信息；</span><br><span class="line">	response.writeHead(200, &#123;&#39;Content-Type&#39;: &#39;text&#x2F;plain&#39;&#125;);</span><br><span class="line">	&#x2F;&#x2F;指定HTTP回应的内容。</span><br><span class="line">	&#x2F;&#x2F;response.write(&#39;hello world&#39;);</span><br><span class="line">	&#x2F;&#x2F;response.end方法用来写入HTTP回应的具体内容，以及回应完成后关闭本次对话。</span><br><span class="line">	response.end(&#39;hello world&#39;);</span><br><span class="line">	&#x2F;&#x2F;监听端口号和主机名</span><br><span class="line">&#125;).listen(3000, &#39;127.0.0.1&#39;);</span><br><span class="line"></span><br><span class="line">console.log(&#39;127.0.0.1:3000&#39;);</span><br></pre></td></tr></table></figure>


<h4 id="2-加载HTML文件"><a href="#2-加载HTML文件" class="headerlink" title="2. 加载HTML文件"></a>2. 加载HTML文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var http &#x3D; require(&#39;http&#39;);</span><br><span class="line">var fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line">http.createServer(function(req, res)&#123;</span><br><span class="line">	&#x2F;&#x2F;读取HTML文件</span><br><span class="line">	fs.readFile(&#39;.&#x2F;2index.html&#39;, &#39;utf-8&#39;,function(err, data)&#123;</span><br><span class="line">		if(err) throw err;</span><br><span class="line">		&#x2F;&#x2F;为默认或者已存在的头设置一条单独的头内容。</span><br><span class="line">		res.setHeader(&quot;Content-Type&quot;,&quot;text&#x2F;html;charset&#x3D;&#39;utf-8&#39;&quot;);</span><br><span class="line">		&#x2F;&#x2F;响应的数据</span><br><span class="line">		res.end(data);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;).listen(3000, &#39;127.0.0.1&#39;);</span><br></pre></td></tr></table></figure>

<h4 id="3-创建服务器-实现POST方法"><a href="#3-创建服务器-实现POST方法" class="headerlink" title="3 创建服务器, 实现POST方法"></a>3 创建服务器, 实现POST方法</h4><p>一个简单的post请求:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var http &#x3D; require(&#39;http&#39;);</span><br><span class="line">var fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line"></span><br><span class="line">http.createServer(function(req, res) &#123;</span><br><span class="line">	&#x2F;&#x2F;fs模块创建流文件, 名称为post.txt</span><br><span class="line">	var file &#x3D; fs.createWriteStream(&#39;post.txt&#39;);</span><br><span class="line">	&#x2F;&#x2F;&#x2F;&#x2F;管子 pipe自动调用了data,end等事件 writeStream&#x2F;readStream</span><br><span class="line">	req.pipe(file);</span><br><span class="line">	&#x2F;&#x2F; 当有数据流时，写入数据</span><br><span class="line">	req.on(&#39;data&#39;, function(postData)&#123;</span><br><span class="line">		console.log(postData);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	req.on(&#39;end&#39;, function()&#123;</span><br><span class="line">		res.end(&#39;end&#39;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;).listen(3000);</span><br></pre></td></tr></table></figure>


<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-3bdb0fd3627591a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="post请求"></p>
<p>参考链接<br><a href="http://www.ruanyifeng.com/blog/2016/08/http.html" target="_blank" rel="noopener">1.HTTP 协议入门</a><br><a href="http://www.ruanyifeng.com/blog/2016/08/migrate-from-http-to-https.html" target="_blank" rel="noopener">2.HTTPS 升级指南</a><br><a href="http://www.cnblogs.com/biyeymyhjob/archive/2012/07/28/2612910.html" target="_blank" rel="noopener">3.HTTP请求报文和HTTP响应报文</a><br><a href="http://yijiebuyi.com/blog/d37512fc6df0fc4d0adfc2ec5c3d46ff.html" target="_blank" rel="noopener">4.node.js querystring类介绍</a><br><a href="https://segmentfault.com/a/1190000000519006" target="_blank" rel="noopener">5.nodejs中流(stream)的理解</a><br><a href="http://www.cnblogs.com/dolphinX/p/3460545.html" target="_blank" rel="noopener">6.简单理解Socket</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/13/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/13/index/" class="post-title-link" itemprop="url">Node.js基础系列之Event模块【4】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-13 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-13T10:38:59+08:00">2019-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 14:43:26" itemprop="dateModified" datetime="2020-05-28T14:43:26+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index"><span itemprop="name">Node</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>理解JS 单线程、 Node.js EventLoop</li>
<li>理解Node.js事件模块</li>
</ol>
<h3 id="第一部分-前提-Nodejs-EventLoop"><a href="#第一部分-前提-Nodejs-EventLoop" class="headerlink" title="第一部分 前提 Nodejs EventLoop"></a>第一部分 前提 Nodejs EventLoop</h3><h4 id="1-【堆】【栈】【队列】"><a href="#1-【堆】【栈】【队列】" class="headerlink" title="1 【堆】【栈】【队列】"></a>1 【堆】【栈】【队列】</h4><p><img data-src="http://upload-images.jianshu.io/upload_images/326255-bf1b1203a4c73069.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="堆栈队列"></p>
<p>任何一种语言的运行环境都少不了*<em>堆（heap）栈（Stack）队列 (queue) *</em> JS也不例外。</p>
<ol>
<li>JS的<code>临时变量以及调用时的形参</code>等等数据都是存储在<code>栈</code>中；</li>
<li><code>堆</code>则是存储实际的<code>对象</code>;</li>
<li>对象的<code>引用变量名(指针)</code>也是在<code>栈</code>；</li>
</ol>
<p>而队列则是JS在实时运行环境中创建的消息队列或者事件队列。</p>
<p><strong>JS是单线程，所以队列的实现让JS的异步处理有了可能性。</strong></p>
<h4 id="2-单线程、任务队列"><a href="#2-单线程、任务队列" class="headerlink" title="2 单线程、任务队列"></a>2 单线程、任务队列</h4><blockquote>
<p>尽信书不如无书，就喜欢这种有理有据的</p>
</blockquote>
<p>摘录自<a href="http://blog.csdn.net/lin_credible/article/details/40143961" target="_blank" rel="noopener">【朴灵评注】JavaScript 运行机制详解：再谈Event Loop</a></p>
<p>为了避免复杂性，JS从一诞生，<strong>同一个时间只能做一件事</strong>。<br><code>JavaScript就是单线程</code>，这已经成了这门语言的核心特征，将来也不会改变。</p>
<p>为了利用多核CPU的计算能力，HTML5提出Web Worker标准，<code>允许JavaScript脚本创建多个线程</code>，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并<strong>没有改变JavaScript单线程的本质。</strong></p>
<p>异步执行的运行机制</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">（1）所有任务都在主线程上执行，形成一个执行栈（execution context stack）。</span><br><span class="line">（2）主线程之外，还存在一个&quot;任务队列&quot;（task queue）。系统把异步任务放到&quot;任务队列&quot;之中，然后继续执行后续的任务。</span><br><span class="line">（3）一旦&quot;执行栈&quot;中的所有任务执行完毕，系统就会读取&quot;任务队列&quot;。如果这个时候，异步任务已经结束了等待状态，就会从&quot;任务队列&quot;进入执行栈，恢复执行。</span><br><span class="line">（4）主线程不断重复上面的第三步。</span><br></pre></td></tr></table></figure>

<p>上面这段初步地在说event loop。但是异步跟event loop其实没有关系。准确的讲，<strong>【event loop是实现异步的一种机制】</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【上面提到的一系列的手段其实就是实现异步的方法，其中就包括event loop。以及轮询、事件等。】</span><br><span class="line">【所谓轮询：就是你在收银台付钱之后，坐到位置上不停的问服务员你的菜做好了没。】</span><br><span class="line">【所谓（事件）：就是你在收银台付钱之后，你不用不停的问，饭菜做好了服务员会自己告诉你。】</span><br></pre></td></tr></table></figure>

<p>【JavaScript运行环境的运行机制，不是JavaScript的运行机制。】</p>
<h4 id="3-事件循环"><a href="#3-事件循环" class="headerlink" title="3 事件循环"></a>3 事件循环</h4><p>首先我们看一下nodejs本质结构图</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-f87e70367e376a31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>Node.js 通过 libuv 来处理与操作系统的交互，并且因此具备了【异步、非阻塞、事件驱动】的能力。Node.js 实际上是 Javascript 执行线程的<strong>单线程</strong>，真正的<strong>I/O 操作</strong>，底层 API 调用都是通过<code>多线程执行</code>的。</p>
<blockquote>
<p>本质也就是：任务接收是单线程，任务执行是多线程。</p>
</blockquote>
<p>那么也就是主要依靠<code>libuv</code>，那么本文主要介绍Nodejs事件模块，当然离不开原理</p>
<p>为何是这样？</p>
<p>为何这么吊？</p>
<p>为何又出现那么多回调函数？</p>
<p>带着一些列问题搞明白了理论，至于代码，那也调用哪些大神写的API吧！</p>
<p><strong>膜拜大神三秒钟</strong></p>
<p>技术(艺术)源自生活、高于生活。对吧。</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-d471d0bb2ec57f84.gif?imageMogr2/auto-orient/strip" alt="歪瓜仁真会玩"></p>
<p>只要开始启动，那么这个姑娘就开始嗨起来了，其实我们事件循环也是这样的！从启动开始，就一直不停止的监听。</p>
<p>【论英文的重要性】</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-0508d9f9917ca62d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>一图胜千言，但我还是就下图做个简单的梳理吧。我可不想被同为学渣的老铁们骂哈。</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-e991be1421256e2e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>我们程序猿其实工作还是仅限于代码调用编写阶段，主要的核心在于理解内部原理，然后根据需求去编写(复制)代码。</p>
<p>讲个故事吧</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JS单身狗(单线程)无异议，但它也是个贪心的黑心老板，在外边一直接活一直接活，根本无视</span><br><span class="line">员工的死活，程序猿们为了改变世界(为了生存)不得不听产品经理的安排（程序猿心中的恶魔），</span><br><span class="line">产品经理承上启下，一直分发任务(闲就不是代码狗了)，而为了理想而奋战(别给我嘚瑟四点的晨曦，</span><br><span class="line">老子刚下班)。</span><br><span class="line">世界越来越美好(为奋战的人祈祷安康)！</span><br></pre></td></tr></table></figure>


<p>Nodejs中是怎么个情况，请看下图</p>
<p><img data-src="http://upload-images.jianshu.io/upload_images/326255-7399386c22e242bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="event5.png"></p>
<p>好了，结束了，接下来就是代码啦。</p>
<h3 id="第二部分-Events模块概述"><a href="#第二部分-Events模块概述" class="headerlink" title="第二部分 Events模块概述"></a>第二部分 Events模块概述</h3><h4 id="1-Events模块"><a href="#1-Events模块" class="headerlink" title="1 Events模块"></a>1 Events模块</h4><p><strong>Events模块</strong>是Node对“发布/订阅”模式（publish/subscribe）的实现。一个对象通过这个模块，向另一个对象传递消息。</p>
<p><strong>Node</strong>中的<em>Event模块仅仅<em>提供了一个对象: *</em>EventEmitter<strong>, EventEmitter 的</strong>核心*<em>就是</em>事件触发与事件监听器功能的封装。</em></p>
<p>获取<strong>EventEmitter</strong>对象</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;引用模块events, 点语法获取到EventEmitter</span><br><span class="line">var EventEmitter &#x3D; require(&#39;events&#39;).EventEmitter;</span><br><span class="line">&#x2F;&#x2F;初始化一个对象, 这个实例就是消息中心。</span><br><span class="line">var emitter &#x3D; new EventEmitter;</span><br></pre></td></tr></table></figure>


<h4 id="2-EventEmitter-实例对象的方法"><a href="#2-EventEmitter-实例对象的方法" class="headerlink" title="2 EventEmitter 实例对象的方法"></a>2 EventEmitter 实例对象的方法</h4><p><em>2.1 emitter.on(eventName, listener), 监听事件,如果触发就调用回调函数</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. eventName &lt;String&gt; | &lt;Symbol&gt;: 事件名称, 后边可以跟上函数;</span><br><span class="line">2. listener &lt;Function&gt; : 回调函数;</span><br></pre></td></tr></table></figure>
<p><em>2.2 emitter.emit(eventName[, …args]), 根据eventName发送通知, 触发事件, 第一个参数为事件名称, 其余的参数会依次传入回调函数</em></p>
<p>以上两个方法的示例代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var EventEmitter &#x3D; require(&#39;events&#39;).EventEmitter;</span><br><span class="line">var emitter &#x3D; new EventEmitter();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;监听函数1, 事件名为--fun1</span><br><span class="line">emitter.on(&#39;fun1&#39;, function()&#123;</span><br><span class="line">	console.log(&#39;触发函数1&#39;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;定义有参数函数fun2, </span><br><span class="line">var fun2 &#x3D; function(para)&#123;</span><br><span class="line">	console.log(&#39;触发函数2, 参数为&#39; + para);</span><br><span class="line">&#125;;</span><br><span class="line">&#x2F;&#x2F;监听fun2</span><br><span class="line">emitter.on(&#39;fun2&#39;, fun2);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;触发事件名</span><br><span class="line">emitter.emit(&#39;fun1&#39;);</span><br><span class="line">&#x2F;&#x2F;触发事件名并且传参数</span><br><span class="line">emitter.emit(&#39;fun2&#39;, &#39;event&#39;);</span><br></pre></td></tr></table></figure>
<p>打印结果为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ node 2on.js </span><br><span class="line">触发函数1</span><br><span class="line">触发函数2, 参数为event</span><br></pre></td></tr></table></figure>

<p><em>2.3 emitter.once(eventName, listener), 类似on方法, 但回调函数只是执行一次</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var EventEmitter &#x3D; require(&#39;events&#39;).EventEmitter;</span><br><span class="line">var emitter &#x3D; new EventEmitter();</span><br><span class="line"></span><br><span class="line">emitter.once(&#39;oncefun&#39;, function()&#123;</span><br><span class="line">	console.log(&#39;函数只执行一次&#39;);</span><br><span class="line">&#125;);</span><br><span class="line">emitter.emit(&#39;oncefun&#39;);</span><br><span class="line">emitter.emit(&#39;oncefun&#39;);</span><br><span class="line"></span><br><span class="line">console.log(&#39;--------&#39;)</span><br><span class="line"></span><br><span class="line">emitter.on(&#39;fun&#39;, function()&#123;</span><br><span class="line">	console.log(&#39;函数&#39;);</span><br><span class="line">&#125;);</span><br><span class="line">emitter.emit(&#39;fun&#39;);</span><br><span class="line">emitter.emit(&#39;fun&#39;);</span><br></pre></td></tr></table></figure>

<p>执行的结果为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ node 3once.js </span><br><span class="line">函数只执行一次</span><br><span class="line">函数</span><br><span class="line">函数</span><br></pre></td></tr></table></figure>
<p>虽然触发多次oncefun, 但依然打印一次;与下边形成对比;,</p>
<p><em>2.4 emitter.addListener(eventName, listener)类似于emitter.on(eventName, listener)</em></p>
<p><em>2.5 emitter.removeListener(eventName, listener), 移除监听</em></p>
<p>详细见实例代码:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var EventEmitter &#x3D; require(&#39;events&#39;).EventEmitter;</span><br><span class="line">var emitter &#x3D; new EventEmitter();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;定义一个函数</span><br><span class="line">var removeFun &#x3D; function()&#123;</span><br><span class="line">	console.log(&#39;输出结果&#39;);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;以fun名称监听removeFun</span><br><span class="line">emitter.on(&#39;fun&#39;, removeFun);</span><br><span class="line">&#x2F;&#x2F;每个30毫秒触发一次回调函数</span><br><span class="line">setInterval(function()&#123;</span><br><span class="line">	emitter.emit(&#39;fun&#39;);</span><br><span class="line">&#125;, 30);</span><br><span class="line">&#x2F;&#x2F;200毫秒以后触发回调函数</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">	emitter.removeListener(&#39;fun&#39;, removeFun);</span><br><span class="line">&#125;, 200);</span><br></pre></td></tr></table></figure>

<p>打印结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ node 5removeListener.js </span><br><span class="line">输出结果</span><br><span class="line">输出结果</span><br><span class="line">输出结果</span><br><span class="line">输出结果</span><br><span class="line">输出结果</span><br><span class="line"></span><br><span class="line">#光标停止</span><br></pre></td></tr></table></figure>



<p>######第三部分 更多API详见</p>
<p>语法名称觉得挺好的, 见名知意. 更多的语法就看<a href="https://nodejs.org/api/events.html#events_emitter_removelistener_eventname_listener" target="_blank" rel="noopener">Node官网</a>吧 -__-</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Event: &#39;newListener&#39;</span><br><span class="line">Event: &#39;removeListener&#39;</span><br><span class="line">EventEmitter.listenerCount(emitter, eventName)</span><br><span class="line">EventEmitter.defaultMaxListeners</span><br><span class="line">emitter.addListener(eventName, listener)</span><br><span class="line">emitter.emit(eventName[, ...args])</span><br><span class="line">emitter.eventNames()</span><br><span class="line">emitter.getMaxListeners()</span><br><span class="line">emitter.listenerCount(eventName)</span><br><span class="line">emitter.listeners(eventName)</span><br><span class="line">emitter.on(eventName, listener)</span><br><span class="line">emitter.once(eventName, listener)</span><br><span class="line">emitter.prependListener(eventName, listener)</span><br><span class="line">emitter.prependOnceListener(eventName, listener)</span><br><span class="line">emitter.removeAllListeners([eventName])</span><br><span class="line">emitter.removeListener(eventName, listener)</span><br><span class="line">emitter.setMaxListeners(n)</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/12/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/12/index/" class="post-title-link" itemprop="url">Python基础系列之--阶段总结【8】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-12 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-12T10:38:59+08:00">2019-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>补充基础阶段相关内容</li>
<li>回顾基础系列之<strong>数据类型</strong></li>
</ol>
<h3 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h3><p>有了前一部分的铺垫，相信大家已经明白<strong>变量名只是对内存空间的映射</strong>，那么</p>
<ol>
<li>共享变量是怎么回事？</li>
<li>深浅拷贝又是是什么？</li>
</ol>
<h4 id="1-赋值与深浅拷贝"><a href="#1-赋值与深浅拷贝" class="headerlink" title="1. 赋值与深浅拷贝"></a>1. 赋值与深浅拷贝</h4><p>🤔 思考如下代码，<code>a、b、c、x</code>四者在<code>x = x + [3, 4]</code>前后的地址是如何变化的？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">c = <span class="number">1</span></span><br><span class="line"><span class="comment"># print(" a: %s \n b: %s \n c: %s" % (id(a), id(b), id(c)))</span></span><br><span class="line"><span class="comment"># print(" -----")</span></span><br><span class="line">x = [a, b, c]</span><br><span class="line"><span class="comment"># print(" x: %s \n ------ \n x[0]: %s \n x[1]: %s \n x[2]: %s" % (id(x), id(x[0]), id(x[1]), id(x[2])))</span></span><br><span class="line">x = x + [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="comment"># print(" -----")</span></span><br><span class="line"><span class="comment"># print(" x: %s \n ------ \n x[0]: %s \n x[1]: %s \n x[2]: %s" % (id(x), id(x[0]), id(x[1]), id(x[2])))</span></span><br><span class="line">a = <span class="number">3</span></span><br><span class="line"><span class="comment"># print(" a: %s" % (id(a)))</span></span><br></pre></td></tr></table></figure>

<p>打印结果如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a: <span class="number">4323184656</span></span><br><span class="line">b: <span class="number">4323184688</span></span><br><span class="line">c: <span class="number">4323184656</span></span><br><span class="line">-----</span><br><span class="line">x: <span class="number">4324441928</span></span><br><span class="line">------</span><br><span class="line">x[<span class="number">0</span>]: <span class="number">4323184656</span></span><br><span class="line">x[<span class="number">1</span>]: <span class="number">4323184688</span></span><br><span class="line">x[<span class="number">2</span>]: <span class="number">4323184656</span></span><br><span class="line">-----</span><br><span class="line">x: <span class="number">4324441928</span>, y: <span class="number">4324441928</span></span><br><span class="line">-----</span><br><span class="line">x: <span class="number">4326634696</span></span><br><span class="line">------</span><br><span class="line">x[<span class="number">0</span>]: <span class="number">4323184656</span></span><br><span class="line">x[<span class="number">1</span>]: <span class="number">4323184688</span></span><br><span class="line">x[<span class="number">2</span>]: <span class="number">4323184656</span></span><br><span class="line">a: <span class="number">4323184720</span></span><br></pre></td></tr></table></figure>

<p><img data-src="01.jpg" alt="四种情况"></p>
<ol>
<li>尽量用<code>+=</code>,<code>-=</code>之类复合符号的，因为无需开辟新的，+=会自动调用 extend 方法进行合并运算, 共享引用；</li>
<li><strong>【不可变对象】</strong>：如打印结果中的<code>开始和结束</code>的<code>a</code>,地址是不同的，重新申请地址；</li>
<li><strong>【可变对象】</strong>：无需重新申请地址，但区域可长可短；</li>
</ol>
<h4 id="2-浅拷贝"><a href="#2-浅拷贝" class="headerlink" title="2. 浅拷贝"></a>2. 浅拷贝</h4><p>不管多么复杂的数据结构，浅拷贝都只会 copy 一层；如需<strong>完整拷贝，请参考深拷贝</strong>，还记得这个图么？</p>
<p><img data-src="7.jpg" alt="浅复制"></p>
<h4 id="3-深拷贝"><a href="#3-深拷贝" class="headerlink" title="3. 深拷贝"></a>3. 深拷贝</h4><p>深拷贝——即 python 的 copy 模块提供的另一个 deepcopy 方法。深拷贝会完全复制原变量相关的所有数据，在内存中生成一套完全一样的内容，在这个过程中我们对这两个变量中的一个进行<strong>任意修改都不会影响其他变量</strong>。</p>
<p><img data-src="9.jpg" alt="深复制"></p>
<h3 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h3><h4 id="1-打印-Print"><a href="#1-打印-Print" class="headerlink" title="1. 打印 Print"></a>1. 打印 Print</h4><p>日常调试，还是离不开打印的，大概了解下如何打印，有两种：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. %</span><br><span class="line">2. format</span><br></pre></td></tr></table></figure>

<p>举几个简单的例子</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">" x: %s, y: %s"</span> % (id(x), id(y)))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(<span class="string">"hello"</span>, <span class="string">"world"</span>))</span><br><span class="line">print(<span class="string">"&#123;1&#125; &#123;0&#125;"</span>.format(<span class="string">"hello"</span>, <span class="string">"world"</span>))</span><br></pre></td></tr></table></figure>

<p><strong>表格</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%s    字符串 (采用str()的显示)</span><br><span class="line">%r    字符串 (采用repr()的显示)</span><br><span class="line">%c    单个字符</span><br><span class="line">%b    二进制整数</span><br><span class="line">%d    十进制整数</span><br><span class="line">%i    十进制整数</span><br><span class="line">%o    八进制整数</span><br><span class="line">%x    十六进制整数</span><br><span class="line">%e    指数 (基底写为e)</span><br><span class="line">%E    指数 (基底写为E)</span><br><span class="line">%f    浮点数</span><br><span class="line">%F    浮点数，与上相同</span><br><span class="line">%g    指数(e)或浮点数 (根据显示长度)</span><br><span class="line">%G    指数(E)或浮点数 (根据显示长度)</span><br></pre></td></tr></table></figure>

<h3 id="第三部分-前期知识汇总"><a href="#第三部分-前期知识汇总" class="headerlink" title="第三部分 前期知识汇总"></a>第三部分 前期知识汇总</h3><p><img data-src="Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png" alt="Python基础数据类型"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/10/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/index/" class="post-title-link" itemprop="url">Python基础系列之--变量、赋值、引用【7】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-10T10:38:59+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>了解变量名与变量的关系</li>
<li>理解引用、拷贝、赋值等概念与含义</li>
</ol>
<h4 id="1-前提概况"><a href="#1-前提概况" class="headerlink" title="1 前提概况"></a>1 前提概况</h4><p>我们接触最多的就是<strong>变量</strong>，究竟<code>变量名</code> 与 <code>变量值</code> 关系是啥？如何存储？</p>
<p>首先看一个最简单的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>上侧是一个<strong>赋值操作</strong>，其中<code>a是变量名</code>，<code>100是变量的值</code>。编程语言的编译器（或者解释器）处理到这一句代码的时候，一般语言会这样做</p>
<ol>
<li>在内存中<strong>开辟</strong>一个内存空间, <strong>地址</strong>0x4377878280;</li>
<li><strong>存放</strong>100进第一步的空间中；</li>
<li><strong>取值</strong>100时，找到地址为<strong>0x4377878280</strong>即可。</li>
</ol>
<p><strong>但是</strong><br><strong>但是</strong><br><strong>但是</strong></p>
<p>这么长除了计算机能记住，我是记不住。正如ip地址与域名的关系，我们只需要记住taobao.com即可，所以，<strong>编译器给我们做了个表，在这个表中，它将内存地址和变量名做了个映射</strong></p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>内存地址</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>0x4377878280</td>
</tr>
<tr>
<td>b</td>
<td>0x4377878281</td>
</tr>
<tr>
<td>c</td>
<td>0x4377878282</td>
</tr>
<tr>
<td>…</td>
<td>….</td>
</tr>
</tbody></table>
<p><strong>变量名完全可以看成一个内存地址的别名（只是方便我们记忆），真正的数据是存在这个内存地址的存储空间上的。变量名在运行的时候，没有任何用处。</strong></p>
<p><img data-src="a.jpg" alt="赋值"></p>
<h4 id="2-深入一些"><a href="#2-深入一些" class="headerlink" title="2. 深入一些"></a>2. 深入一些</h4><p>奔着：以问题来解决疑问题，先看这个代码，思考一下结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>values = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values[<span class="number">1</span>] = values</span><br></pre></td></tr></table></figure>

<p><strong>请认真思考此时 values 是多少？</strong><br><strong>请认真思考此时 values 是多少？</strong><br><strong>请认真思考此时 values 是多少？</strong></p>
<p>也许你认为是<code>[0, [0, 1, 2], 2]</code>,原因可能是：</p>
<ol>
<li>list 可变；</li>
<li>把list[1]的位置直接添加一个list；</li>
</ol>
<p>代码如下，<code>完全符合预期</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="number">1</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是结果却是 <strong>无限循环</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>values</span><br><span class="line">[<span class="number">0</span>, [...], <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>❌就❎在第二步中<br>其中涉及两个概念：引用、拷贝</p>
</blockquote>
<p>第一部分已经说过，<strong>变量名是内存的别称</strong>，</p>
<p><code>a=10</code>的含义：内存中有个地址0x1234567的空间存了10，然后a指向这块内存。</p>
<p><img data-src="1.jpg" alt="变量多次&#39;赋值‘"></p>
<p><strong>上图中很好的证明了，变量‘赋不同值’，只是引用不同而已</strong></p>
<p><code>values[1] = values</code>只是把自身指向自身。如图：</p>
<p><img data-src="3.jpg" alt="自身引用自身"></p>
<p>如需达到预期效果，只需要类似于你的逻辑，<strong>指向一份值相同但内存不同的值</strong></p>
<p><img data-src="5.jpg" alt="值相同但内存不同"></p>
<p>代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拷贝生成一份新的数据，</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values[<span class="number">1</span>] = values[:]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values</span><br><span class="line">[<span class="number">0</span>, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<p>往更深处说，values[:] 复制操作是所谓的「浅复制」(shallow copy)，当列表对象有嵌套的时候也会产生出乎意料的错误，比如</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">0</span>, [<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>]</span><br><span class="line">b = a[:]</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">8</span></span><br><span class="line">a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">9</span></span><br><span class="line"><span class="comment"># 正确答案</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a)</span><br><span class="line">[<span class="number">8</span>, [<span class="number">1</span>, <span class="number">9</span>], <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(b)</span><br><span class="line">[<span class="number">0</span>, [<span class="number">1</span>, <span class="number">9</span>], <span class="number">3</span>]</span><br><span class="line"><span class="comment"># a 与 b 的地址确实不同</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(id(a))</span><br><span class="line"><span class="number">4355761096</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(id(b))</span><br><span class="line"><span class="number">4355761416</span></span><br><span class="line"><span class="comment"># 但是内部list的地址确实相同的，也就是共同指向了同一块内存地址</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(id(a[<span class="number">1</span>]))</span><br><span class="line"><span class="number">4354260680</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(id(b[<span class="number">1</span>]))</span><br><span class="line"><span class="number">4354260680</span></span><br></pre></td></tr></table></figure>

<p>看完上图的打印结果，请看下图；</p>
<p><img data-src="7.jpg" alt="浅复制"></p>
<p><strong>重点： values[:] 只是浅层复制</strong><br><strong>重点： values[:] 只是浅层复制</strong><br><strong>重点： values[:] 只是浅层复制</strong></p>
<p>正确的复制嵌套元素的方法是进行「深复制」(deep copy)，方法是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0</span>, [<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>]</span><br><span class="line">b = copy.deepcopy(a)</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">8</span></span><br><span class="line">a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">9</span></span><br></pre></td></tr></table></figure>

<p><img data-src="9.jpg" alt="深复制"></p>
<h4 id="3-引用-VS-拷贝："><a href="#3-引用-VS-拷贝：" class="headerlink" title="3 引用 VS 拷贝："></a>3 引用 VS 拷贝：</h4><ol>
<li>没有限制条件的分片表达式（L[:]）能够复制序列，但此法<strong>只能浅层复制</strong>。</li>
<li>字典 copy 方法，D.copy() 能够复制字典，但此法<strong>只能浅层复制</strong></li>
<li>有些内置函数，例如 list，能够生成拷贝 list(L)</li>
<li>copy 标准库模块能够生成完整拷贝：<strong>deepcopy 本质上是递归 copy</strong></li>
<li></li>
</ol>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://my.oschina.net/leejun2005/blog/145911" target="_blank" rel="noopener">python基础（5）：深入理解 python 中的赋值、引用、拷贝、作用域 原</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2019/05/09/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/09/index/" class="post-title-link" itemprop="url">Python基础系列之--迭代器/解析式【6】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-09 10:38:59" itemprop="dateCreated datePublished" datetime="2019-05-09T10:38:59+08:00">2019-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.7k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>掌握解析式的使用</li>
</ol>
<ul>
<li>liet 解析式</li>
<li>dict 解析式</li>
</ul>
<ol start="2">
<li>深入理解迭代器</li>
<li>深入理解生成器</li>
</ol>
<h3 id="第一部分-迭代器、生成器"><a href="#第一部分-迭代器、生成器" class="headerlink" title="第一部分 迭代器、生成器"></a>第一部分 迭代器、生成器</h3><p>参考<a href="https://foofish.net/iterators-vs-generators.html" target="_blank" rel="noopener">完全理解Python迭代对象、迭代器、生成器</a>, 完整实例请看原文。</p>
<blockquote>
<p>在了解Python的数据结构时，<strong>容器(container)</strong>、<strong>可迭代对象(iterable)</strong>、<strong>迭代器(iterator)</strong>、<strong>生成器(generator)</strong>、<strong>列表/集合/字典推导式(list,set,dict comprehension)</strong>众多概念参杂在一起，难免让初学者一头雾水，我将用一篇文章试图将这些概念以及它们之间的关系捋清楚。</p>
</blockquote>
<p><img data-src="relationships.png" alt="关系图"></p>
<blockquote>
<p>请仔细看上图<br>请仔细看上图<br>请仔细看上图</p>
</blockquote>
<h4 id="1-容器（container）"><a href="#1-容器（container）" class="headerlink" title="1 容器（container）"></a>1 容器（container）</h4><p>像列表（list）、集合（set）、序列（tuple）、字典（dict）都是容器。简单的说，容器是一种把多个元素组织在一起的数据结构， <code>【可以逐个迭代获取其中的元素。】</code><strong>但是，但是，但这并不是容器本身提供的能力</strong>，而是<code>可迭代对象赋予了容器这种能力</code>，当然并不是所有的容器都是可迭代的，比如：<a href="https://zh.wikipedia.org/wiki/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8" target="_blank" rel="noopener">Bloom filter</a>，虽然Bloom filter可以用来检测某个元素是否包含在容器中，但是并不能从容器中获取其中的每一个值，因为Bloom filter压根就没把元素存储在容器中，而是通过一个散列函数映射成一个值保存在数组中。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'a'</span> <span class="keyword">in</span> &#123;<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>&#125; <span class="comment"># 输出 True</span></span><br><span class="line"><span class="string">'a'</span> <span class="keyword">in</span> &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125; <span class="comment"># 输出 True</span></span><br><span class="line"><span class="string">'a'</span> <span class="keyword">in</span> set([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]) <span class="comment"># 输出 True</span></span><br></pre></td></tr></table></figure>

<h4 id="2-可迭代对象-iterable"><a href="#2-可迭代对象-iterable" class="headerlink" title="2 可迭代对象(iterable)"></a>2 可迭代对象(iterable)</h4><blockquote>
<p>凡是可以返回一个迭代器的对象都可称之为可迭代对象</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = iter(x)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = iter(x)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(y)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(y)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(z)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(x)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span><span class="params">(y)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">list_iterator</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里x是一个可迭代对象，<strong>可迭代对象和容器一样是一种通俗的叫法</strong>，并不是指某种具体的数据类型，<code>list是可迭代对象，dict是可迭代对象，set也是可迭代对象</code>。<br>y和z是两个独立的迭代器，迭代器内部持有一个状态，该状态用于记录当前迭代所在的位置，以方便下次迭代的时候获取正确的元素。<br>迭代器有一种具体的迭代器类型，比如list_iterator，set_iterator。<br><strong>可迭代对象实现了<strong>iter</strong>方法，该方法返回一个迭代器对象。</strong></p>
<p><img data-src="iterable-vs-iterator.png" alt=""></p>
<h4 id="3-迭代器-iterator"><a href="#3-迭代器-iterator" class="headerlink" title="3 迭代器(iterator)"></a>3 迭代器(iterator)</h4><p>那么什么迭代器呢？它是一个带状态的对象，他能在你调用next()方法的时候返回容器中的下一个值，<strong>任何实现了<strong>iter</strong>和<strong>next</strong>()（python2中实现next()）方法的对象都是迭代器</strong>，<br><strong>iter</strong>返回迭代器自身，<br><strong>next</strong>返回容器中的下一个值，<br>如果容器中没有更多元素了，则抛出StopIteration异常，至于它们到底是如何实现的这并不重要。</p>
<p>所以，迭代器就是实现了工厂模式的对象，它在你每次你询问要下一个值的时候给你返回。有很多关于迭代器的例子，比如itertools函数返回的都是迭代器对象。</p>
<blockquote>
<p>迭代器就像一个懒加载的工厂，等到有人需要的时候才给它生成值返回，没调用的时候就处于休眠状态等待下一次调用。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> cycle</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = cycle([<span class="string">'red'</span>, <span class="string">'white'</span>, <span class="string">'blue'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(colors)</span><br><span class="line"><span class="string">'red'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(colors)</span><br><span class="line"><span class="string">'white'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(colors)</span><br><span class="line"><span class="string">'blue'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(colors)</span><br><span class="line"><span class="string">'red'</span></span><br></pre></td></tr></table></figure>


<h4 id="4-生成器-generator"><a href="#4-生成器-generator" class="headerlink" title="4 生成器(generator)"></a>4 生成器(generator)</h4><p><strong>生成器算得上是Python语言中最吸引人的特性之一</strong>生成器其实是一种特殊的迭代器，不过这种迭代器更加优雅。<br>它不需要再像上面的类一样写<strong>iter</strong>()和<strong>next</strong>()方法了，<strong>只需要一个yiled关键字</strong>。<br><strong>生成器一定是迭代器（反之不成立）</strong>，因此任何生成器也是以一种懒加载的模式生成值。用生成器来实现斐波那契数列的例子是：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">()</span>:</span></span><br><span class="line">    prev, curr = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> curr</span><br><span class="line">        prev, curr = curr, curr + prev</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = fib()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(islice(f, <span class="number">0</span>, <span class="number">10</span>))</span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">55</span>]</span><br></pre></td></tr></table></figure>
<p><strong>说实在的没看懂，后续章节补充这个。。。</strong></p>
<p><strong>总结：</strong></p>
<ol>
<li>容器是一系列元素的集合，str、list、set、dict、file、sockets对象都可以看作是容器<br>容器都可以被迭代（用在for，while等语句中），因此他们被称为可迭代对象。</li>
<li>可迭代对象实现了<strong>iter</strong>方法，该方法返回一个迭代器对象。</li>
<li>迭代器持有一个内部状态的字段，用于记录下次迭代返回值，它实现了<strong>next</strong>和<strong>iter</strong>方法，迭代器不会一次性把所有元素加载到内存，而是需要的时候才生成返回结果。</li>
<li>生成器是一种特殊的迭代器，它的返回值不是通过return而是用yield。</li>
</ol>
<h3 id="第二部分-解析式"><a href="#第二部分-解析式" class="headerlink" title="第二部分 解析式"></a>第二部分 解析式</h3><h4 id="1-什么是列表解析式？"><a href="#1-什么是列表解析式？" class="headerlink" title="1 什么是列表解析式？"></a>1 什么是列表解析式？</h4><p><strong>列表解析式是将一个列表（实际上适用于任何可迭代对象（iterable））转换成另一个列表的工具。</strong>在转换过程中，可以指定元素必须符合一定的条件，才能添加至新的列表中，这样每个元素都可以按需要进行转换。<a href="http://codingpy.com/article/python-list-comprehensions-explained-visually/" target="_blank" rel="noopener">参考</a></p>
<p><img data-src="ex.png" alt=""></p>
<blockquote>
<p>如果看过图就明白了，就结束啦</p>
</blockquote>
<h4 id="2-Show-Code"><a href="#2-Show-Code" class="headerlink" title="2 Show Code"></a>2 Show Code</h4><p><strong>需求： 遍历数组，将满足条件的数据放入新的数组中</strong></p>
<p><em>单层嵌套</em></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一般的写法</span></span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">doubled_odds = []</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        doubled_odds.append(n)</span><br></pre></td></tr></table></figure>

<p><strong>*解析式表达如下，分三部分</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">doubled_odds = [</span><br><span class="line">    n,</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers</span><br><span class="line">    f n % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong></p>
<p>基本语法： <code>[ expr  for item in iterable  judge ]</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. expr 待操作元素</span><br><span class="line">2. for item in iterable  循环语句【可嵌套，从后往前】</span><br><span class="line">3. judge 判断条件 【可选】</span><br></pre></td></tr></table></figure>

<p><em>双层嵌套</em></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tmpList = [ [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]  ]</span><br><span class="line">newList =[</span><br><span class="line">    n</span><br><span class="line">    <span class="comment"># 先后再前</span></span><br><span class="line">    <span class="keyword">for</span> inNum <span class="keyword">in</span> inList  <span class="keyword">for</span> inList <span class="keyword">in</span> tmpList</span><br><span class="line">    <span class="comment"># 判断语句可选</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>参照list解析式，记住语法，其实也不难</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flipped &#x3D; &#123;</span><br><span class="line">    value: key</span><br><span class="line">    for key, value in original.items()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>























      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Howard</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">287k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:21</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey   : 'AIzaSyAw-MAkCIHtrUzbfhgfXaE2q2QCCJDTbAY',
      projectId: 'blog-bcc62'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page
      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = CONFIG.hostname === location.hostname;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>




      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  


</body>
</html>
